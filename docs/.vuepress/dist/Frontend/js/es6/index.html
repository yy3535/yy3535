<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES6 | yy3535</title>
    <meta name="description" content="yy3535的笔记">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.9cd8b68b.css" as="style"><link rel="preload" href="/assets/js/app.6687386d.js" as="script"><link rel="preload" href="/assets/js/19.742b6037.js" as="script"><link rel="prefetch" href="/assets/js/10.0675a461.js"><link rel="prefetch" href="/assets/js/11.e52f9dd3.js"><link rel="prefetch" href="/assets/js/12.5d6121f3.js"><link rel="prefetch" href="/assets/js/13.c3f0d6d9.js"><link rel="prefetch" href="/assets/js/14.0a2c4e99.js"><link rel="prefetch" href="/assets/js/15.88369d48.js"><link rel="prefetch" href="/assets/js/16.f257081f.js"><link rel="prefetch" href="/assets/js/17.d2ec8ae8.js"><link rel="prefetch" href="/assets/js/18.a83b733d.js"><link rel="prefetch" href="/assets/js/2.a8af945e.js"><link rel="prefetch" href="/assets/js/20.d1b1a5b4.js"><link rel="prefetch" href="/assets/js/21.24a62a4a.js"><link rel="prefetch" href="/assets/js/22.9b982cf8.js"><link rel="prefetch" href="/assets/js/23.64fe6b98.js"><link rel="prefetch" href="/assets/js/24.bbc6e3b1.js"><link rel="prefetch" href="/assets/js/25.57558a64.js"><link rel="prefetch" href="/assets/js/26.17b049ea.js"><link rel="prefetch" href="/assets/js/27.3a6ae6d2.js"><link rel="prefetch" href="/assets/js/28.0ffd254c.js"><link rel="prefetch" href="/assets/js/29.4ddef416.js"><link rel="prefetch" href="/assets/js/3.d2fc0ee4.js"><link rel="prefetch" href="/assets/js/30.1fa54287.js"><link rel="prefetch" href="/assets/js/31.2648900c.js"><link rel="prefetch" href="/assets/js/32.771479fc.js"><link rel="prefetch" href="/assets/js/33.d99b44ad.js"><link rel="prefetch" href="/assets/js/34.4ddd33fd.js"><link rel="prefetch" href="/assets/js/35.b53b1720.js"><link rel="prefetch" href="/assets/js/36.a7ff32a6.js"><link rel="prefetch" href="/assets/js/37.6b969c60.js"><link rel="prefetch" href="/assets/js/38.18ccadc9.js"><link rel="prefetch" href="/assets/js/39.f4326261.js"><link rel="prefetch" href="/assets/js/4.c387c497.js"><link rel="prefetch" href="/assets/js/40.d9a8c14a.js"><link rel="prefetch" href="/assets/js/5.3a3c7b8d.js"><link rel="prefetch" href="/assets/js/6.945167e7.js"><link rel="prefetch" href="/assets/js/7.e17a2802.js"><link rel="prefetch" href="/assets/js/8.6ca5c166.js"><link rel="prefetch" href="/assets/js/9.042cf3e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9cd8b68b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="yy3535" class="logo"> <span class="site-name can-hide">yy3535</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Frontend/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/Backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/Operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="https://github.com/yy3535/yy3535" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Frontend/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/Backend/" class="nav-link">后端</a></div><div class="nav-item"><a href="/Operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="https://github.com/yy3535/yy3535" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>js</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/js/jsbasic/" class="sidebar-link">01-JS基础知识</a></li><li><a href="/Frontend/js/jsbasic/zepto.html" class="sidebar-link">zepto源码解读</a></li><li><a href="/Frontend/js/jsbasic/shenrubibao.html" class="sidebar-link">深入理解javascript原型链和闭包</a></li><li><a href="/Frontend/js/jswebapi/" class="sidebar-link">02-JS-WEB-API</a></li><li><a href="/Frontend/js/devenv/" class="sidebar-link">03-开发环境</a></li><li><a href="/Frontend/js/runenv/" class="sidebar-link">04-运行环境</a></li><li><a href="/Frontend/js/es6/" class="active sidebar-link">ES6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#let和const" class="sidebar-link">let和const</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#let" class="sidebar-link">let</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#块级作用域" class="sidebar-link">块级作用域</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#const" class="sidebar-link">const</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#es6声明变量的六种方法" class="sidebar-link">ES6声明变量的六种方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#顶层对象的属性" class="sidebar-link">顶层对象的属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#globalthis对象" class="sidebar-link">globalThis对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#解构赋值-deconstruction" class="sidebar-link">解构赋值(deconstruction)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#规则" class="sidebar-link">规则</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#本质" class="sidebar-link">本质</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#默认值" class="sidebar-link">默认值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#对象的解构赋值" class="sidebar-link">对象的解构赋值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#注意点" class="sidebar-link">注意点</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#字符串的解构赋值" class="sidebar-link">字符串的解构赋值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#数值和布尔值的解构赋值" class="sidebar-link">数值和布尔值的解构赋值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#函数参数的解构赋值" class="sidebar-link">函数参数的解构赋值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#圆括号问题" class="sidebar-link">圆括号问题</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用途" class="sidebar-link">用途</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#字符串的扩展" class="sidebar-link">字符串的扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#字符的-unicode-表示法" class="sidebar-link">字符的 Unicode 表示法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#直接输入u-2028和u-2029" class="sidebar-link">直接输入U+2028和U+2029</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#json-stringify-的改造" class="sidebar-link">JSON.stringify() 的改造</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#模板字符串" class="sidebar-link">模板字符串</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#标签模板" class="sidebar-link">标签模板</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#字符串的新增方法" class="sidebar-link">字符串的新增方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#正则的扩展" class="sidebar-link">正则的扩展</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#数值的扩展" class="sidebar-link">数值的扩展</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#函数的扩展" class="sidebar-link">函数的扩展</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#数组的扩展" class="sidebar-link">数组的扩展</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#对象的扩展" class="sidebar-link">对象的扩展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#属性" class="sidebar-link">属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#super-关键字" class="sidebar-link">super 关键字</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#扩展运算符（对象）-es2018" class="sidebar-link">扩展运算符（对象）[ES2018]</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#对象的新增方法" class="sidebar-link">对象的新增方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#symbol" class="sidebar-link">Symbol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#引入原因" class="sidebar-link">引入原因</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#值" class="sidebar-link">值</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#symbol-api" class="sidebar-link">Symbol API</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#作为对象属性名" class="sidebar-link">作为对象属性名</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#作为常量" class="sidebar-link">作为常量</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#set-和-map-数据结构" class="sidebar-link">Set 和 Map 数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#weakset" class="sidebar-link">WeakSet</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#map" class="sidebar-link">Map</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#weakmap" class="sidebar-link">WeakMap</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#proxy" class="sidebar-link">Proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#参数-4" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#注意" class="sidebar-link">注意</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#操作方法" class="sidebar-link">操作方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#proxy-revocable" class="sidebar-link">Proxy.revocable()</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用途-3" class="sidebar-link">用途</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#reflect" class="sidebar-link">Reflect</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概念-4" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#静态方法（大部分与object对象的同名方法的作用相同，而且它与proxy对象的方法是一一对应的。）" class="sidebar-link">静态方法（大部分与Object对象的同名方法的作用相同，而且它与Proxy对象的方法是一一对应的。）</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#使用-proxy-实现观察者模式" class="sidebar-link">使用 Proxy 实现观察者模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#promise对象" class="sidebar-link">Promise对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概念-5" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#参数-5" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#构造函数方法-2" class="sidebar-link">构造函数方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#实例方法-2" class="sidebar-link">实例方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#promise实现一个ajax操作" class="sidebar-link">Promise实现一个Ajax操作</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#应用" class="sidebar-link">应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#iterator和for-of循环" class="sidebar-link">Iterator和for..of循环</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概念-6" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#iterator接口" class="sidebar-link">Iterator接口</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#具备iterator接口的数据结构" class="sidebar-link">具备Iterator接口的数据结构</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#调用iterator接口的场合" class="sidebar-link">调用Iterator接口的场合</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#遍历器对象部署的方法" class="sidebar-link">遍历器对象部署的方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#for-of循环" class="sidebar-link">for...of循环</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#generator-函数的语法" class="sidebar-link">Generator 函数的语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概念-7" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#next-方法" class="sidebar-link">next()方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#构造函数" class="sidebar-link">构造函数</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#generator函数里执行generator函数。" class="sidebar-link">Generator函数里执行Generator函数。</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#作为对象属性" class="sidebar-link">作为对象属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#作为状态机" class="sidebar-link">作为状态机</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#应用（可以暂停函数执行，返回任意表达式的值。）" class="sidebar-link">应用（可以暂停函数执行，返回任意表达式的值。）</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#generator-函数的异步应用" class="sidebar-link">Generator 函数的异步应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#es5的异步处理方法" class="sidebar-link">ES5的异步处理方法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#传统异步编程的解决方案（多任务的解决方案）协程" class="sidebar-link">传统异步编程的解决方案（多任务的解决方案）协程</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#协程在es6中的实现（generator-函数）" class="sidebar-link">协程在ES6中的实现（Generator 函数）</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#co模块" class="sidebar-link">co模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#async函数" class="sidebar-link">async函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#是-generator-函数的语法糖。" class="sidebar-link">是 Generator 函数的语法糖。</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#基本用法" class="sidebar-link">基本用法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#await命令" class="sidebar-link">await命令</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#async函数实现原理" class="sidebar-link">async函数实现原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#扩展运算符…" class="sidebar-link">扩展运算符…</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用于对象的展开-es7" class="sidebar-link">用于对象的展开(es7)</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用于数组的展开" class="sidebar-link">用于数组的展开</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用于剩余运算符" class="sidebar-link">用于剩余运算符</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#class-的基本语法" class="sidebar-link">Class 的基本语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#静态方法（不会被实例继承，而是直接通过类来调用）" class="sidebar-link">静态方法（不会被实例继承，而是直接通过类来调用）</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#静态属性" class="sidebar-link">静态属性()</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#实例属性" class="sidebar-link">实例属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#私有方法和私有属性" class="sidebar-link">私有方法和私有属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#new-target-属性" class="sidebar-link">new.target 属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#class-的继承" class="sidebar-link">Class 的继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#简介-2" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#获取父类" class="sidebar-link">获取父类</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#super-关键字-2" class="sidebar-link">super 关键字</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#类的-prototype-属性和-proto-属性" class="sidebar-link">类的 prototype 属性和_proto_属性</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#原生构造函数（js内置构造函数）的继承" class="sidebar-link">原生构造函数（js内置构造函数）的继承</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#mixin模式的实现" class="sidebar-link">Mixin模式的实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#module的语法" class="sidebar-link">Module的语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#概述-2" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#export命令" class="sidebar-link">export命令</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#import命令" class="sidebar-link">import命令</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#模块的整体加载" class="sidebar-link">模块的整体加载</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#export-default命令" class="sidebar-link">export default命令</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#export-与-import-的复合写法" class="sidebar-link">export 与 import 的复合写法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#import" class="sidebar-link">import()</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#module的加载实现" class="sidebar-link">Module的加载实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#浏览器加载" class="sidebar-link">浏览器加载</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#es6-模块与-commonjs-模块的差异" class="sidebar-link">ES6 模块与 CommonJS 模块的差异</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#node加载" class="sidebar-link">Node加载</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#es6-模块的转码" class="sidebar-link">ES6 模块的转码</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#编程风格" class="sidebar-link">编程风格</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#异步遍历器" class="sidebar-link">异步遍历器</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#arraybuffer" class="sidebar-link">ArrayBuffer</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#最新提案" class="sidebar-link">最新提案</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#修饰器" class="sidebar-link">修饰器</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#es5中的类" class="sidebar-link">es5中的类</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#用es5实现es6class类" class="sidebar-link">用es5实现es6Class类</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#装饰器" class="sidebar-link">装饰器</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#其他语法" class="sidebar-link">其他语法</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#第三方模块" class="sidebar-link">第三方模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#babel" class="sidebar-link">babel</a></li><li class="sidebar-sub-header"><a href="/Frontend/js/es6/#moment" class="sidebar-link">moment</a></li></ul></li></ul></li><li><a href="/Frontend/js/designpatterns/" class="sidebar-link">前端设计模式</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/css.html" class="sidebar-link">css</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/vue.html" class="sidebar-link">vue</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/webpack.html" class="sidebar-link">webpack</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>前端跳槽面试必备技巧</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/viewskills.html" class="sidebar-link">前端跳槽面试必备技巧</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>JS数据结构与算法</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/algorithm.html" class="sidebar-link">前端算法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>小工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/vuepress.html" class="sidebar-link">vuepress</a></li><li><a href="/Frontend/markdown.html" class="sidebar-link">markdown</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>自动化测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/automatedTest.html" class="sidebar-link">js单元测试的一门语言Jest</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Frontend/other.html" class="sidebar-link">其他</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="es6"><a href="#es6" aria-hidden="true" class="header-anchor">#</a> ES6</h1> <p></p><div class="table-of-contents"><ul><li><a href="#let和const">let和const</a><ul><li><a href="#let">let</a></li><li><a href="#块级作用域">块级作用域</a></li><li><a href="#const">const</a></li><li><a href="#es6声明变量的六种方法">ES6声明变量的六种方法</a></li><li><a href="#顶层对象的属性">顶层对象的属性</a></li><li><a href="#globalthis对象">globalThis对象</a></li></ul></li><li><a href="#解构赋值-deconstruction">解构赋值(deconstruction)</a><ul><li><a href="#定义">定义</a></li><li><a href="#规则">规则</a></li><li><a href="#本质">本质</a></li><li><a href="#默认值">默认值</a></li><li><a href="#对象的解构赋值">对象的解构赋值</a></li><li><a href="#注意点">注意点</a></li><li><a href="#字符串的解构赋值">字符串的解构赋值</a></li><li><a href="#数值和布尔值的解构赋值">数值和布尔值的解构赋值</a></li><li><a href="#函数参数的解构赋值">函数参数的解构赋值</a></li><li><a href="#圆括号问题">圆括号问题</a></li><li><a href="#用途">用途</a></li></ul></li><li><a href="#字符串的扩展">字符串的扩展</a><ul><li><a href="#字符的-unicode-表示法">字符的 Unicode 表示法</a></li><li><a href="#直接输入u-2028和u-2029">直接输入U+2028和U+2029</a></li><li><a href="#json-stringify-的改造">JSON.stringify() 的改造</a></li><li><a href="#模板字符串">模板字符串</a></li><li><a href="#标签模板">标签模板</a></li></ul></li><li><a href="#字符串的新增方法">字符串的新增方法</a></li><li><a href="#正则的扩展">正则的扩展</a></li><li><a href="#数值的扩展">数值的扩展</a></li><li><a href="#函数的扩展">函数的扩展</a></li><li><a href="#数组的扩展">数组的扩展</a></li><li><a href="#对象的扩展">对象的扩展</a><ul><li><a href="#属性">属性</a></li><li><a href="#super-关键字">super 关键字</a></li><li><a href="#扩展运算符（对象）-es2018">扩展运算符（对象）[ES2018]</a></li></ul></li><li><a href="#对象的新增方法">对象的新增方法</a></li><li><a href="#symbol">Symbol</a><ul><li><a href="#引入原因">引入原因</a></li><li><a href="#概念">概念</a></li><li><a href="#参数">参数</a></li><li><a href="#值">值</a></li><li><a href="#symbol-api">Symbol API</a></li><li><a href="#作为对象属性名">作为对象属性名</a></li><li><a href="#作为常量">作为常量</a></li></ul></li><li><a href="#set-和-map-数据结构">Set 和 Map 数据结构</a><ul><li><a href="#set">Set</a></li><li><a href="#weakset">WeakSet</a></li><li><a href="#map">Map</a></li><li><a href="#weakmap">WeakMap</a></li></ul></li><li><a href="#proxy">Proxy</a><ul><li><a href="#概述">概述</a></li><li><a href="#参数">参数</a></li><li><a href="#注意">注意</a></li><li><a href="#操作方法">操作方法</a></li><li><a href="#proxy-revocable">Proxy.revocable()</a></li><li><a href="#用途">用途</a></li></ul></li><li><a href="#reflect">Reflect</a><ul><li><a href="#概念">概念</a></li><li><a href="#静态方法（大部分与object对象的同名方法的作用相同，而且它与proxy对象的方法是一一对应的。）">静态方法（大部分与Object对象的同名方法的作用相同，而且它与Proxy对象的方法是一一对应的。）</a></li><li><a href="#使用-proxy-实现观察者模式">使用 Proxy 实现观察者模式</a></li></ul></li><li><a href="#promise对象">Promise对象</a><ul><li><a href="#概念">概念</a></li><li><a href="#参数">参数</a></li><li><a href="#构造函数方法">构造函数方法</a></li><li><a href="#实例方法">实例方法</a></li><li><a href="#promise实现一个ajax操作">Promise实现一个Ajax操作</a></li><li><a href="#应用">应用</a></li></ul></li><li><a href="#iterator和for-of循环">Iterator和for..of循环</a><ul><li><a href="#概念">概念</a></li><li><a href="#iterator接口">Iterator接口</a></li><li><a href="#具备iterator接口的数据结构">具备Iterator接口的数据结构</a></li><li><a href="#调用iterator接口的场合">调用Iterator接口的场合</a></li><li><a href="#遍历器对象部署的方法">遍历器对象部署的方法</a></li><li><a href="#for-of循环">for...of循环</a></li></ul></li><li><a href="#generator-函数的语法">Generator 函数的语法</a><ul><li><a href="#概念">概念</a></li><li><a href="#next-方法">next()方法</a></li><li><a href="#构造函数">构造函数</a></li><li><a href="#generator函数里执行generator函数。">Generator函数里执行Generator函数。</a></li><li><a href="#作为对象属性">作为对象属性</a></li><li><a href="#作为状态机">作为状态机</a></li><li><a href="#应用（可以暂停函数执行，返回任意表达式的值。）">应用（可以暂停函数执行，返回任意表达式的值。）</a></li></ul></li><li><a href="#generator-函数的异步应用">Generator 函数的异步应用</a><ul><li><a href="#es5的异步处理方法">ES5的异步处理方法</a></li><li><a href="#传统异步编程的解决方案（多任务的解决方案）协程">传统异步编程的解决方案（多任务的解决方案）协程</a></li><li><a href="#协程在es6中的实现（generator-函数）">协程在ES6中的实现（Generator 函数）</a></li><li><a href="#co模块">co模块</a></li></ul></li><li><a href="#async函数">async函数</a><ul><li><a href="#是-generator-函数的语法糖。">是 Generator 函数的语法糖。</a></li><li><a href="#基本用法">基本用法</a></li><li><a href="#await命令">await命令</a></li><li><a href="#async函数实现原理">async函数实现原理</a></li></ul></li><li><a href="#扩展运算符-…">扩展运算符…</a><ul><li><a href="#用于对象的展开-es7">用于对象的展开(es7)</a></li><li><a href="#用于数组的展开">用于数组的展开</a></li><li><a href="#用于剩余运算符">用于剩余运算符</a></li></ul></li><li><a href="#class-的基本语法">Class 的基本语法</a><ul><li><a href="#简介">简介</a></li><li><a href="#静态方法（不会被实例继承，而是直接通过类来调用）">静态方法（不会被实例继承，而是直接通过类来调用）</a></li><li><a href="#静态属性">静态属性()</a></li><li><a href="#实例属性">实例属性</a></li><li><a href="#私有方法和私有属性">私有方法和私有属性</a></li><li><a href="#new-target-属性">new.target 属性</a></li></ul></li><li><a href="#class-的继承">Class 的继承</a><ul><li><a href="#简介">简介</a></li><li><a href="#获取父类">获取父类</a></li><li><a href="#super-关键字">super 关键字</a></li><li><a href="#类的-prototype-属性和-proto-属性">类的 prototype 属性和_proto_属性</a></li><li><a href="#原生构造函数（js内置构造函数）的继承">原生构造函数（js内置构造函数）的继承</a></li><li><a href="#mixin模式的实现">Mixin模式的实现</a></li></ul></li><li><a href="#module的语法">Module的语法</a><ul><li><a href="#概述">概述</a></li><li><a href="#export命令">export命令</a></li><li><a href="#import命令">import命令</a></li><li><a href="#模块的整体加载">模块的整体加载</a></li><li><a href="#export-default命令">export default命令</a></li><li><a href="#export-与-import-的复合写法">export 与 import 的复合写法</a></li><li><a href="#import">import()</a></li></ul></li><li><a href="#module的加载实现">Module的加载实现</a><ul><li><a href="#浏览器加载">浏览器加载</a></li><li><a href="#es6-模块与-commonjs-模块的差异">ES6 模块与 CommonJS 模块的差异</a></li><li><a href="#node加载">Node加载</a></li><li><a href="#es6-模块的转码">ES6 模块的转码</a></li><li><a href="#编程风格">编程风格</a></li><li><a href="#异步遍历器">异步遍历器</a></li><li><a href="#arraybuffer">ArrayBuffer</a></li><li><a href="#最新提案">最新提案</a></li><li><a href="#修饰器">修饰器</a></li><li><a href="#es5中的类">es5中的类</a></li><li><a href="#用es5实现es6class类">用es5实现es6Class类</a></li></ul></li><li><a href="#装饰器">装饰器</a></li><li><a href="#其他语法">其他语法</a></li><li><a href="#第三方模块">第三方模块</a><ul><li><a href="#babel">babel</a></li><li><a href="#moment">moment</a></li></ul></li></ul></div><p></p> <h2 id="let和const"><a href="#let和const" aria-hidden="true" class="header-anchor">#</a> let和const</h2> <h3 id="let"><a href="#let" aria-hidden="true" class="header-anchor">#</a> let</h3> <ul><li>有作用域(声明的变量，只在let命令所在的代码块内有效。)</li> <li>不存在变量提升</li> <li>暂时性死区(TDZ)
<ul><li>只要块级作用域内存在let命令，它所声明的变量就“绑定”（binding）这个区域，不再受外部的影响。凡是在声明之前就使用这些变量，就会报错。</li></ul> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  tmp <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
  <span class="token keyword">let</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>不允许重复声明</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 报错</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="块级作用域"><a href="#块级作用域" aria-hidden="true" class="header-anchor">#</a> 块级作用域</h3> <ul><li>为什么需要块级作用域？
<ul><li>内层变量可能会覆盖外层变量。</li> <li>用来计数的循环变量泄露为全局变量。</li></ul></li> <li>ES6块级作用域
<ul><li>let为 JavaScript 新增了块级作用域</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>块级作用域的出现，实际上使得获得广泛应用的立即执行函数表达式（IIFE）不再必要了。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// IIFE 写法</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 块级作用域写法</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>S5 规定，函数只能在顶层作用域和函数作用域之中声明，不能在块级作用域声明。ES6允许在块级作用域之中声明函数。ES6 规定，块级作用域之中，函数声明语句的行为类似于let，在块级作用域之外不可引用。</li></ul></li></ul> <h3 id="const"><a href="#const" aria-hidden="true" class="header-anchor">#</a> const</h3> <ul><li>声明一个只读的常量。一旦声明，常量的值就不能改变。</li> <li>一旦声明变量，就必须立即初始化，不能留到以后赋值。</li> <li>只能保证变量指向的那个内存地址所保存的数据不得改动，对于复合类型的数据（主要是对象和数组），指向的数据结构不能保证不可变</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可执行</span>
a<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 可执行</span>
a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Dave'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 报错</span>
</code></pre></div><ul><li>冻结对象：<code>Object.freeze</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 常规模式时，下面一行不起作用；</span>
<span class="token comment">// 严格模式时，该行会报错</span>
foo<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
</code></pre></div><p>彻底冻结对象：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">constantize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">constantize</span><span class="token punctuation">(</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>用处(模块引用等不需要更改的地方)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span>xxx
</code></pre></div><h3 id="es6声明变量的六种方法"><a href="#es6声明变量的六种方法" aria-hidden="true" class="header-anchor">#</a> ES6声明变量的六种方法</h3> <ul><li>ES5:var,function</li> <li>ES6添加四种：let,const,import,class</li></ul> <h3 id="顶层对象的属性"><a href="#顶层对象的属性" aria-hidden="true" class="header-anchor">#</a> 顶层对象的属性</h3> <ul><li>顶层对象
<ul><li>浏览器环境：window对象</li> <li>Node：global对象</li> <li>ES5 之中，顶层对象的属性与全局变量是等价的。
<ul><li>问题
<ul><li>没法在编译时就报出变量未声明的错误，只有运行时才能知道</li> <li>程序员很容易不知不觉地就创建了全局变量（比如打字出错）</li> <li>window对象有实体含义，指的是浏览器的窗口对象，顶层对象是一个有实体含义的对象，也是不合适的。</li></ul></li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
a <span class="token comment">// 1</span>

a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>a <span class="token comment">// 2</span>
</code></pre></div><ul><li>ES6 开始，全局变量将逐步与顶层对象的属性脱钩。</li> <li>为了保持兼容性,var命令和function命令声明的全局变量，依旧是顶层对象的属性；</li> <li>let命令、const命令、class命令声明的全局变量，不属于顶层对象的属性。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 如果在 Node 的 REPL 环境，可以写成 global.a</span>
<span class="token comment">// 或者采用通用方法，写成 this.a</span>
window<span class="token punctuation">.</span>a <span class="token comment">// 1</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>b <span class="token comment">// undefined</span>
</code></pre></div><h3 id="globalthis对象"><a href="#globalthis对象" aria-hidden="true" class="header-anchor">#</a> globalThis对象</h3> <ul><li>顶层对象（提供全局作用域）
<ul><li>浏览器里面，顶层对象是window，但 Node 和 Web Worker 没有window。</li> <li>浏览器和 Web Worker 里面，self也指向顶层对象，但是 Node 没有self。</li> <li>Node 里面，顶层对象是global，但其他环境都不支持。</li></ul></li> <li>为了能够在各种环境，都能取到顶层对象，一般使用this变量
<ul><li>局限性
<ul><li>全局环境中，this会返回顶层对象。但是，Node 模块和 ES6 模块中，this返回的是当前模块。</li> <li>函数里面的this，如果函数不是作为对象的方法运行，而是单纯作为函数运行，this会指向顶层对象。但是，严格模式下，这时this会返回undefined。</li> <li>不管是严格模式，还是普通模式，new Function('return this')()，总是会返回全局对象。但是，如果浏览器用了 CSP（Content Security Policy，内容安全策略），那么eval、new Function这些方法都可能无法使用。</li></ul></li> <li>解决</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 方法一</span>
<span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span>
  <span class="token operator">?</span> window
  <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> process <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> require <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">typeof</span> global <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
    <span class="token operator">?</span> global
    <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 方法二</span>
<span class="token keyword">var</span> <span class="token function-variable function">getGlobal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> self <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> self<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> window<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> global <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> global<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unable to locate global object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>提案
<ul><li>引入globalThis作为顶层对象（任何环境下，globalThis都是存在的，都可以从它拿到顶层对象，指向全局环境下的this。）</li></ul></li></ul></li></ul> <h2 id="解构赋值-deconstruction"><a href="#解构赋值-deconstruction" aria-hidden="true" class="header-anchor">#</a> 解构赋值(deconstruction)</h2> <h3 id="定义"><a href="#定义" aria-hidden="true" class="header-anchor">#</a> 定义</h3> <ul><li>按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructuring）。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>bar<span class="token punctuation">]</span><span class="token punctuation">,</span> baz<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 解构不成功，变量的值就等于undefined</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>bar<span class="token punctuation">,</span> foo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 不完全解构(等号左边的模式，只匹配一部分的等号右边的数组)，解构依然可以成功。</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
a <span class="token comment">// 1</span>
b <span class="token comment">// 2</span>
d <span class="token comment">// 4</span>
<span class="token comment">// 只要某种数据结构具有 Iterator 接口，都可以采用数组形式的解构赋值。否则会报错。</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// Set和Generator都可以，因为有Iterator接口</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
x <span class="token comment">// &quot;a&quot;</span>
</code></pre></div><h3 id="规则"><a href="#规则" aria-hidden="true" class="header-anchor">#</a> 规则</h3> <ul><li>只要等号右边的值不是对象或数组，就先将其转为对象。</li></ul> <h3 id="本质"><a href="#本质" aria-hidden="true" class="header-anchor">#</a> 本质</h3> <ul><li>属于“模式匹配”，只要等号两边的模式相同，左边的变量就会被赋予对应的值。</li></ul> <h3 id="默认值"><a href="#默认值" aria-hidden="true" class="header-anchor">#</a> 默认值</h3> <ul><li>解构赋值允许指定默认值。</li> <li>只有当一个数组成员严格等于undefined，默认值才会生效。</li> <li>如果默认值是一个表达式，那么这个表达式是惰性求值的，即只有在用到的时候，才会求值。</li> <li>默认值可以引用解构赋值的其他变量，但该变量必须已经声明。<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">[</span>foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
foo <span class="token comment">// true</span>

<span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// x='a', y='b'</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// x='a', y='b'</span>

<span class="token keyword">let</span> <span class="token punctuation">[</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// x=1; y=1</span>
</code></pre></div></li></ul> <h3 id="对象的解构赋值"><a href="#对象的解构赋值" aria-hidden="true" class="header-anchor">#</a> 对象的解构赋值</h3> <ul><li>数组的取值由它的位置决定；而对象属性变量必须与属性同名，才能取到正确的值。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token string">'bbb'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>内部机制是先找到同名属性，然后再赋给对应的变量。真正被赋值的是后者，而不是前者。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> baz <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> bar<span class="token punctuation">:</span> <span class="token string">'bbb'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
baz <span class="token comment">// &quot;aaa&quot;</span>
foo <span class="token comment">// error: foo is not defined</span>
</code></pre></div><h3 id="注意点"><a href="#注意点" aria-hidden="true" class="header-anchor">#</a> 注意点</h3> <ul><li>大括号不要在行首，否则会解释为代码块，需要加上小括号解决</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> x<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>可以对数组进行对象属性的解构(数组本质是特殊的对象)</li></ul> <h3 id="字符串的解构赋值"><a href="#字符串的解构赋值" aria-hidden="true" class="header-anchor">#</a> 字符串的解构赋值</h3> <ul><li>字符串被转换成了一个类似数组的对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
a <span class="token comment">// &quot;h&quot;</span>
b <span class="token comment">// &quot;e&quot;</span>
c <span class="token comment">// &quot;l&quot;</span>
d <span class="token comment">// &quot;l&quot;</span>
e <span class="token comment">// &quot;o&quot;</span>
</code></pre></div><ul><li>类似数组的对象都有一个length属性</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span>length <span class="token punctuation">:</span> len<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
len <span class="token comment">// 5</span>
</code></pre></div><h3 id="数值和布尔值的解构赋值"><a href="#数值和布尔值的解构赋值" aria-hidden="true" class="header-anchor">#</a> 数值和布尔值的解构赋值</h3> <ul><li>数值和布尔值的包装对象都有toString属性，因此变量s都能取到值。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span>toString<span class="token punctuation">:</span> s<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
s <span class="token operator">===</span> <span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token comment">// true</span>

<span class="token keyword">let</span> <span class="token punctuation">{</span>toString<span class="token punctuation">:</span> s<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
s <span class="token operator">===</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token comment">// true</span>
</code></pre></div><ul><li>undefined和null无法转为对象，所以对它们进行解构赋值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> prop<span class="token punctuation">:</span> x <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> prop<span class="token punctuation">:</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre></div><h3 id="函数参数的解构赋值"><a href="#函数参数的解构赋值" aria-hidden="true" class="header-anchor">#</a> 函数参数的解构赋值</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3, 8]</span>
<span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3, 0]</span>
<span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [0, 0]</span>
<span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [0, 0]</span>
</code></pre></div><h3 id="圆括号问题"><a href="#圆括号问题" aria-hidden="true" class="header-anchor">#</a> 圆括号问题</h3> <ul><li>变量声明语句，不能使用圆括号。</li> <li>函数参数也属于变量声明，不能带有圆括号。</li> <li>赋值语句，模式部分不能放在圆括号中。</li> <li>赋值语句的非模式部分，可以使用圆括号</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">{</span> p<span class="token punctuation">:</span> a <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span> p<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// 报错</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 正确</span>
</code></pre></div><h3 id="用途"><a href="#用途" aria-hidden="true" class="header-anchor">#</a> 用途</h3> <ul><li>交换变量的值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>从函数返回多个值</li> <li>函数参数的定义</li> <li>提取 JSON 数据</li> <li>函数参数的默认值</li> <li>遍历 Map 结构</li> <li>输入模块的指定方法</li></ul> <h2 id="字符串的扩展"><a href="#字符串的扩展" aria-hidden="true" class="header-anchor">#</a> 字符串的扩展</h2> <h3 id="字符的-unicode-表示法"><a href="#字符的-unicode-表示法" aria-hidden="true" class="header-anchor">#</a> 字符的 Unicode 表示法</h3> <ul><li>现在共有 6 种方法可以表示一个字符。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'\z'</span> <span class="token operator">===</span> <span class="token string">'z'</span>  <span class="token comment">// true</span>
<span class="token string">'\172'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\x7A'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\u007A'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
<span class="token string">'\u{7A}'</span> <span class="token operator">===</span> <span class="token string">'z'</span> <span class="token comment">// true</span>
</code></pre></div><ul><li>字符串的遍历器接口
<ul><li>最大的优点是可以识别大于0xFFFF的码点，传统的for循环无法识别这样的码点。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 字符串可以被for...of循环遍历。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> codePoint <span class="token keyword">of</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>codePoint<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;f&quot;</span>
<span class="token comment">// &quot;o&quot;</span>
<span class="token comment">// &quot;o&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> text <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCodePoint</span><span class="token punctuation">(</span><span class="token number">0x20BB7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> text<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot; &quot;</span>
<span class="token comment">// &quot; &quot;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;𠮷&quot;</span>
</code></pre></div><h3 id="直接输入u-2028和u-2029"><a href="#直接输入u-2028和u-2029" aria-hidden="true" class="header-anchor">#</a> 直接输入U+2028和U+2029</h3> <ul><li>JavaScript 规定有5个字符，不能在字符串里面直接使用，只能使用转义形式。
<ul><li>U+005C：反斜杠（reverse solidus)</li> <li>U+000D：回车（carriage return）</li> <li>U+2028：行分隔符（line separator）</li> <li>U+2029：段分隔符（paragraph separator）</li> <li>U+000A：换行符（line feed）
JSON 格式允许字符串里面直接使用 U+2028（行分隔符）和 U+2029（段分隔符）。这样一来，服务器输出的 JSON 被JSON.parse解析，就有可能直接报错。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token string">'&quot;\u2028&quot;'</span><span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能报错</span>
</code></pre></div><p>JSON 格式已经冻结（RFC 7159），没法修改了。为了消除这个报错，ES2019 允许 JavaScript 字符串直接输入 U+2028（行分隔符）和 U+2029（段分隔符）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PS</span> <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;'\u2029'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="json-stringify-的改造"><a href="#json-stringify-的改造" aria-hidden="true" class="header-anchor">#</a> JSON.stringify() 的改造</h3> <ul><li>根据标准，JSON 数据必须是 UTF-8 编码。但是，现在的JSON.stringify()方法有可能返回不符合 UTF-8 标准的字符串。</li> <li>为了确保返回的是合法的 UTF-8 字符，ES2019 改变了JSON.stringify()的行为。如果遇到0xD800到0xDFFF之间的单个码点，或者不存在的配对形式，它会返回转义字符串，留给应用自己决定下一步的处理。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'\u{D834}'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;&quot;\\uD834&quot;&quot;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'\uDF06\uD834'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;&quot;\\udf06\\ud834&quot;&quot;</span>
</code></pre></div><h3 id="模板字符串"><a href="#模板字符串" aria-hidden="true" class="header-anchor">#</a> 模板字符串</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#result'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
  There are &lt;b&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>basket<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/b&gt; items
   in your basket, &lt;em&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>basket<span class="token punctuation">.</span>onSale<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/em&gt;
  are on sale!
`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
`
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
</code></pre></div><ul><li>用`（反引号）标识，用${}将变量括起来。支持换行</li> <li>所有的空格,缩进和换行都会被保留</li> <li>可以放入任意的JavaScript表达式，可以进行运算</li> <li>可以调用函数</li> <li>需要使用反引号，则前面要用反斜杠转义。</li> <li>嵌套使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">tmpl</span> <span class="token operator">=</span> <span class="token parameter">addrs</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`
  &lt;table&gt;
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>addrs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">addr</span> <span class="token operator">=&gt;</span> `
    <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span><span class="token operator">&lt;</span>td<span class="token operator">&gt;</span>$<span class="token punctuation">{</span>addr<span class="token punctuation">.</span>first<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>addr<span class="token punctuation">.</span>last<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/td&gt;&lt;/tr&gt;
  `</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
`<span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> first<span class="token punctuation">:</span> <span class="token string">'&lt;Jane&gt;'</span><span class="token punctuation">,</span> last<span class="token punctuation">:</span> <span class="token string">'Bond'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> first<span class="token punctuation">:</span> <span class="token string">'Lars'</span><span class="token punctuation">,</span> last<span class="token punctuation">:</span> <span class="token string">'&lt;Croft&gt;'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">tmpl</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>引用模板字符串本身，在需要时执行，可以写成函数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!`</span></span><span class="token punctuation">;</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Hello Jack!&quot;</span>
</code></pre></div><h3 id="标签模板"><a href="#标签模板" aria-hidden="true" class="header-anchor">#</a> 标签模板</h3> <ul><li>定义
<ul><li>紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 无参数</span>
alert<span class="token template-string"><span class="token string">`123`</span></span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token comment">// 有参数</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
tag<span class="token template-string"><span class="token string">`Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> a <span class="token operator">+</span> b <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> world </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> a <span class="token operator">*</span> b <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token comment">// 第一个参数是一个数组(是模板字符串中那些没有变量替换的部分)（包括一个自带的raw属性，保存了转译后的原第一个参数的数组['Hello ', ' world ', '']）</span>
<span class="token comment">// 其他参数是模板字符串各个变量被替换后的值</span>
<span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Hello '</span><span class="token punctuation">,</span> <span class="token string">' world '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>应用
<ul><li>过滤 HTML 字符串，防止用户输入恶意内容。</li> <li>多语言转换（国际化处理）</li> <li>通过标签函数，代替Mustache 之类的模板库（添加条件判断和循环处理功能）</li> <li>调用其他语言的函数，在 JavaScript 语言之中嵌入其他语言。</li></ul></li></ul> <h2 id="字符串的新增方法"><a href="#字符串的新增方法" aria-hidden="true" class="header-anchor">#</a> 字符串的新增方法</h2> <ul><li>见api</li></ul> <h2 id="正则的扩展"><a href="#正则的扩展" aria-hidden="true" class="header-anchor">#</a> 正则的扩展</h2> <ul><li>见正则基础</li></ul> <h2 id="数值的扩展"><a href="#数值的扩展" aria-hidden="true" class="header-anchor">#</a> 数值的扩展</h2> <ul><li>见变量部分</li></ul> <h2 id="函数的扩展"><a href="#函数的扩展" aria-hidden="true" class="header-anchor">#</a> 函数的扩展</h2> <ul><li>见函数API</li></ul> <h2 id="数组的扩展"><a href="#数组的扩展" aria-hidden="true" class="header-anchor">#</a> 数组的扩展</h2> <ul><li>见数组API</li></ul> <h2 id="对象的扩展"><a href="#对象的扩展" aria-hidden="true" class="header-anchor">#</a> 对象的扩展</h2> <h3 id="属性"><a href="#属性" aria-hidden="true" class="header-anchor">#</a> 属性</h3> <h4 id="属性的写法"><a href="#属性的写法" aria-hidden="true" class="header-anchor">#</a> 属性的写法</h4> <ul><li>简洁表示法
<ul><li>直接写变量（属性名为变量名, 属性值为变量的值）</li> <li>简写函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">method</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>属性名表达式
<ul><li>属性名的两种写法<code>obj.foo = true;</code>和<code>obj['a' + 'bc'] = 123;</code></li> <li>字面量方式(大括号)定义对象，ES6规定可用<code>['a' + 'bc']</code>定义属性</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> propKey <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>propKey<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token operator">+</span> <span class="token string">'bc'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token string">'h'</span> <span class="token operator">+</span> <span class="token string">'ello'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'hi'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <ul><li>属性名表达式与简洁表示法，不能同时使用</li></ul></div> <h4 id="函数属性的name属性"><a href="#函数属性的name属性" aria-hidden="true" class="header-anchor">#</a> 函数属性的name属性</h4> <ul><li>方法的name属性返回函数名</li> <li>方法使用了取值函数（getter）和存值函数（setter），返回值是方法名前加上get和set。</li> <li>bind方法创造的函数，name属性返回bound加上原函数的名字</li> <li>Function构造函数创造的函数，name属性返回anonymous。</li></ul> <h4 id="属性遍历"><a href="#属性遍历" aria-hidden="true" class="header-anchor">#</a> 属性遍历</h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>可枚举性
<ul><li>对象的每个属性都有一个描述对象（Descriptor），用来控制该属性的行为。<code>Object.getOwnPropertyDescriptor</code>方法可以获取该属性的描述对象。其中有个<code>enumerable</code>为false即不可枚举。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  {</span>
<span class="token comment">//    value: 123,</span>
<span class="token comment">//    writable: true,</span>
<span class="token comment">//    enumerable: true,</span>
<span class="token comment">//    configurable: true</span>
<span class="token comment">//  }</span>
</code></pre></div></li> <li>不可枚举的属性
<ul><li>所有 Class 的原型的方法都是不可枚举的。</li> <li>toString</li> <li>length</li></ul></li> <li>忽略不可枚举属性的方法
<ul><li>for...in循环：只遍历对象自身的和继承的可枚举的属性。</li> <li>Object.keys()：返回对象自身的所有可枚举的属性的键名。</li> <li>JSON.stringify()：只串行化对象自身的可枚举的属性。</li> <li>Object.assign()： 忽略enumerable为false的属性，只拷贝对象自身的可枚举的属性。</li></ul></li></ul></div> <ul><li>属性遍历的五种方法
<ul><li>for...in</li> <li>Object.keys(obj)</li> <li>Object.getOwnPropertyNames(obj)</li> <li>Object.getOwnPropertySymbols(obj)</li> <li>Reflect.ownKeys(obj)</li></ul></li></ul> <h3 id="super-关键字"><a href="#super-关键字" aria-hidden="true" class="header-anchor">#</a> super 关键字</h3> <ul><li>指向当前对象的原型对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> proto <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> <span class="token string">'hello'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &quot;hello&quot;</span>
</code></pre></div><ul><li>注意
<ul><li>只能用在对象的方法之中</li></ul></li></ul> <h3 id="扩展运算符（对象）-es2018"><a href="#扩展运算符（对象）-es2018" aria-hidden="true" class="header-anchor">#</a> 扩展运算符（对象）[ES2018]</h3> <h4 id="解构赋值"><a href="#解构赋值" aria-hidden="true" class="header-anchor">#</a> 解构赋值</h4> <h4 id="扩展运算符"><a href="#扩展运算符" aria-hidden="true" class="header-anchor">#</a> 扩展运算符</h4> <ul><li>数组是特殊的对象，所以对象的扩展运算符也可以用于数组。</li> <li>扩展运算符后面不是对象，则会自动将其转为对象。</li> <li>对象的扩展运算符等同于使用Object.assign()方法。</li> <li>后面可以跟表达式。</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <ul><li>完整克隆一个对象（对象实例的属性+对象原型的属性）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 写法一</span>
<span class="token keyword">const</span> clone1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  __proto__<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>obj
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 写法二</span>
<span class="token keyword">const</span> clone2 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>
  Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  obj
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写法三</span>
<span class="token keyword">const</span> clone3 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">,</span>
  Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div></div> <ul><li>用处
<ul><li>拷贝对象(另辟一个空间)<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zfpx'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> school<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">...</span>obj<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">深拷贝与浅拷贝</p> <ul><li>浅拷贝(对象的对象引用地址还是同一个)
<ul><li>扩展运算符<code>...</code></li> <li>Object.assign</li></ul></li> <li>深拷贝
<ul><li>$.extend</li> <li>实现深拷贝(通过递归)<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj<span class="token operator">=</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span>b<span class="token punctuation">:</span><span class="token punctuation">{</span>abc<span class="token punctuation">:</span>abc<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj<span class="token operator">!=</span><span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newObj<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>constructor</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    newObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> newObj
<span class="token punctuation">}</span>
<span class="token keyword">let</span> newReg<span class="token operator">=</span><span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newReg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul></div></li> <li>合并对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ab <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>a<span class="token punctuation">,</span> <span class="token operator">...</span>b <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">let</span> ab <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="对象的新增方法"><a href="#对象的新增方法" aria-hidden="true" class="header-anchor">#</a> 对象的新增方法</h2> <ul><li>见对象API</li></ul> <h2 id="symbol"><a href="#symbol" aria-hidden="true" class="header-anchor">#</a> Symbol</h2> <h3 id="引入原因"><a href="#引入原因" aria-hidden="true" class="header-anchor">#</a> 引入原因</h3> <ul><li>对象的属性名容易冲突（引入后对象的属性名有两种类型，一种是字符串，另一种是Symbol 类型，可保证不会冲突）</li></ul> <h3 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>表示独一无二的值。</li> <li>是第七种原始数据类型(js的数据类型：<code>number</code> <code>string</code> <code>boolean</code> <code>null</code> <code>undefined</code> <code>object</code>)</li> <li>Symbol函数前不能使用new命令，不是对象，不能添加属性（类似字符串的数据类型）</li></ul> <h3 id="参数"><a href="#参数" aria-hidden="true" class="header-anchor">#</a> 参数</h3> <ul><li>接受一个字符串作为参数</li> <li>如果 参数是一个对象，就会调用该对象的toString方法，将其转为字符串，然后才生成一个 Symbol 值。</li> <li>相同参数的返回值是不相等的(参数只是表示对当前 Symbol 值的描述)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1 <span class="token comment">// Symbol(foo)</span>
</code></pre></div><h3 id="值"><a href="#值" aria-hidden="true" class="header-anchor">#</a> 值</h3> <ul><li>不能与其他类型的值进行运算</li> <li>可以显式转为字符串，可以转为布尔值，不能转为数值</li></ul> <h3 id="symbol-api"><a href="#symbol-api" aria-hidden="true" class="header-anchor">#</a> Symbol API</h3> <h4 id="构造函数方法"><a href="#构造函数方法" aria-hidden="true" class="header-anchor">#</a> 构造函数方法</h4> <ul><li>Symbol(str)
<ul><li>返回一个Symbol值</li> <li>会被登记在全局环境中供搜索</li></ul></li> <li>Symbol.for(str)
<ul><li>搜索有没有以该参数作为名称的 Symbol 值。有就返回这个 Symbol 值，否则就新建并返回一个以该字符串为名称的 Symbol 值。</li> <li>不会被登记在全局环境中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// true</span>
<span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// false</span>
</code></pre></div></li> <li>Symbol.keyFor(str)
<ul><li>返回一个已登记的 Symbol 类型值的key。<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token comment">// &quot;foo&quot;</span>
</code></pre></div></li></ul></li></ul> <h4 id="_11个内置的symbol值"><a href="#_11个内置的symbol值" aria-hidden="true" class="header-anchor">#</a> 11个内置的Symbol值</h4> <ul><li><p>Symbol.hasInstance</p> <ul><li>对象的Symbol.hasInstance属性，指向一个内部方法。当其他对象使用instanceof运算符，判断是否为该对象的实例时，会调用这个方法。<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> foo <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">new</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div></li></ul></li> <li><p>Symbol.isConcatSpreadable</p> <ul><li>等于一个布尔值，表示该对象用于Array.prototype.concat()时，是否可以展开。<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c', 'd', 'e']</span>
arr1<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token comment">// undefined</span>

<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr2<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', ['c','d'], 'e']</span>
</code></pre></div></li></ul></li> <li><p>Symbol.species</p> <ul><li>对象的Symbol.species属性，指向一个构造函数。创建衍生对象时，会使用该属性。</li> <li>实例对象在运行过程中，需要再次调用自身的构造函数时，会调用该属性指定的构造函数。</li></ul></li> <li><p>Symbol.match</p> <ul><li>对象的Symbol.match属性，指向一个函数。当执行str.match(myObject)时，如果该属性存在，会调用它，返回该方法的返回值。</li></ul></li> <li><p>Symbol.replace</p> <ul><li>对象的Symbol.replace属性，指向一个方法，当该对象被String.prototype.replace方法调用时，会返回该方法的返回值。</li></ul></li> <li><p>Symbol.search</p> <ul><li>对象的Symbol.search属性，指向一个方法，当该对象被String.prototype.search方法调用时，会返回该方法的返回值。</li></ul></li> <li><p>Symbol.split</p> <ul><li>对象的Symbol.split属性，指向一个方法，当该对象被String.prototype.split方法调用时，会返回该方法的返回值。</li></ul></li> <li><p>Symbol.iterator</p> <ul><li>对象的Symbol.iterator属性，指向该对象的默认遍历器方法。对象进行for...of循环时，会调用Symbol.iterator方法，返回该对象的默认遍历器</li></ul></li> <li><p>Symbol.toPrimitive</p> <ul><li>对象的Symbol.toPrimitive属性，指向一个方法。该对象被转为原始类型的值时，会调用这个方法，返回该对象对应的原始类型值。</li></ul></li> <li><p>Symbol.toStringTag</p> <ul><li>对象的Symbol.toStringTag属性，指向一个方法。在该对象上面调用Object.prototype.toString方法时，如果这个属性存在，它的返回值会出现在toString方法返回的字符串之中，表示对象的类型。</li></ul></li> <li><p>Symbol.unscopables</p> <ul><li>对象的Symbol.unscopables属性，指向一个对象。该对象指定了使用with关键字时，哪些属性会被with环境排除。</li></ul></li></ul> <h4 id="实例方法"><a href="#实例方法" aria-hidden="true" class="header-anchor">#</a> 实例方法</h4> <ul><li>Symbol.prototype.description
<ul><li>返回 Symbol 的描述。</li></ul></li> <li></li></ul> <h3 id="作为对象属性名"><a href="#作为对象属性名" aria-hidden="true" class="header-anchor">#</a> 作为对象属性名</h3> <ul><li>不能用点运算符。</li></ul> <h4 id="属性名的遍历"><a href="#属性名的遍历" aria-hidden="true" class="header-anchor">#</a> 属性名的遍历</h4> <ul><li>只能用<code>Object.getOwnPropertySymbols</code>获取指定对象的所有 Symbol 属性名。</li> <li>因为不会被常规方法遍历得到，可以为对象定义一些非私有的、但又希望只用于内部的方法。</li></ul> <h3 id="作为常量"><a href="#作为常量" aria-hidden="true" class="header-anchor">#</a> 作为常量</h3> <ul><li>保证一组常量的值都是不相等的</li> <li>可以保证上面的switch语句会按设计的方式工作。</li> <li>将魔术字符串的变量值改成Symbol 值，确保不会冲突。<div class="warning custom-block"><p class="custom-block-title">魔术字符串</p> <p>在代码之中多次出现、与代码形成强耦合的某一个具体的字符串或者数值。</p></div></li></ul> <h2 id="set-和-map-数据结构"><a href="#set-和-map-数据结构" aria-hidden="true" class="header-anchor">#</a> Set 和 Map 数据结构</h2> <h3 id="set"><a href="#set" aria-hidden="true" class="header-anchor">#</a> Set</h3> <h4 id="概念-2"><a href="#概念-2" aria-hidden="true" class="header-anchor">#</a> 概念</h4> <ul><li>类似于数组，但是成员的值都是唯一的，没有重复的值。</li> <li>没有键名，只有键值（键名和键值是同一个值）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2 3 5 4(不会添加重复的值)</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">数组去重</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 去除数组的重复成员</span>
<span class="token punctuation">[</span><span class="token operator">...</span>new <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">]</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h4 id="参数-2"><a href="#参数-2" aria-hidden="true" class="header-anchor">#</a> 参数</h4> <ul><li>一个用来初始化的具有 iterable 接口的集合</li></ul> <h4 id="值-2"><a href="#值-2" aria-hidden="true" class="header-anchor">#</a> 值</h4> <ul><li>在 Set 内部，两个NaN是相等。两个空对象不相等</li></ul> <h4 id="实例的属性和方法"><a href="#实例的属性和方法" aria-hidden="true" class="header-anchor">#</a> 实例的属性和方法</h4> <div class="warning custom-block"><p class="custom-block-title">属性</p> <ul><li>Set.prototype.constructor：构造函数，默认就是Set函数。</li> <li>Set.prototype.size：返回Set实例的成员总数。</li></ul></div> <div class="warning custom-block"><p class="custom-block-title">操作方法</p> <ul><li>add(value)：添加某个值，返回 Set 结构本身。</li> <li>delete(value)：删除某个值，返回一个布尔值，表示删除是否成功。</li> <li>has(value)：返回一个布尔值，表示该值是否为Set的成员。</li> <li>clear()：清除所有成员，没有返回值。</li></ul></div> <div class="warning custom-block"><p class="custom-block-title">遍历操作</p> <ul><li>keys()：返回键名的遍历器</li> <li>values()：返回键值的遍历器</li> <li>entries()：返回键值对的遍历器</li> <li>forEach((value,key)=&gt;{})：使用回调函数遍历每个成员
<ul><li>第二个参数，表示绑定处理函数内部的this对象。</li></ul></li></ul></div> <h4 id="数组的方法间接用于set"><a href="#数组的方法间接用于set" aria-hidden="true" class="header-anchor">#</a> 数组的方法间接用于Set</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>set<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回Set结构：{2, 4, 6}</span>

<span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> val <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>set<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回Set结构：{2, 4}</span>
</code></pre></div><h4 id="实现并集、交集、差集"><a href="#实现并集、交集、差集" aria-hidden="true" class="header-anchor">#</a> 实现并集、交集、差集</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 并集</span>
<span class="token keyword">let</span> union <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">,</span> <span class="token operator">...</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set {1, 2, 3, 4}</span>

<span class="token comment">// 交集</span>
<span class="token keyword">let</span> intersect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// set {2, 3}</span>

<span class="token comment">// 差集</span>
<span class="token keyword">let</span> difference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>b<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set {1}</span>
</code></pre></div><h3 id="weakset"><a href="#weakset" aria-hidden="true" class="header-anchor">#</a> WeakSet</h3> <ul><li>与Set类似，但成员只能是对象，而不能是其他类型的值。</li> <li>WeakSet 不可遍历（因为垃圾回收机制不考虑 WeakSet 对该对象的引用，所以一旦引用对象被回收，成员数就会减少）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="方法"><a href="#方法" aria-hidden="true" class="header-anchor">#</a> 方法</h4> <ul><li>WeakSet.prototype.add(value)：向 WeakSet 实例添加一个新成员。</li> <li>WeakSet.prototype.delete(value)：清除 WeakSet 实例的指定成员。</li> <li>WeakSet.prototype.has(value)：返回一个布尔值，表示某个值是否在 WeakSet 实例之中</li></ul> <h4 id="用处"><a href="#用处" aria-hidden="true" class="header-anchor">#</a> 用处</h4> <ul><li>储存 DOM 节点
<ul><li>不用担心这些节点从文档移除时，会引发内存泄漏。</li></ul></li></ul> <h3 id="map"><a href="#map" aria-hidden="true" class="header-anchor">#</a> Map</h3> <h4 id="概念-3"><a href="#概念-3" aria-hidden="true" class="header-anchor">#</a> 概念</h4> <ul><li>类似于对象，也是键值对的集合，但是“键”的范围不限于字符串，各种类型的值（包括对象）都可以当作键。</li></ul> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Object 结构提供了“字符串—值”的对应，Map 结构提供了“值—值”的对应，是一种更完善的 Hash 结构实现。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="参数-3"><a href="#参数-3" aria-hidden="true" class="header-anchor">#</a> 参数</h4> <ul><li>任何具有 Iterator 接口、且每个成员都是一个双元素的数组的数据结构</li> <li>Set和Map都可以用来生成新的 Map。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'Author'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="实例的属性"><a href="#实例的属性" aria-hidden="true" class="header-anchor">#</a> 实例的属性</h4> <ul><li>size
<ul><li>返回 Map 结构的成员总数。</li></ul></li></ul> <h4 id="实例的操作方法"><a href="#实例的操作方法" aria-hidden="true" class="header-anchor">#</a> 实例的操作方法</h4> <ul><li>set(key, value)
<ul><li>设置键名key对应的键值为value，然后返回整个 Map 结构。</li> <li>如果key已经有值，则键值会被更新，否则就新生成该键。</li> <li>可以采用链式写法(返回的是当前的Map对象)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>get(key)
<ul><li>读取key对应的键值，如果找不到key，返回undefined。</li></ul></li> <li>has(key)
<ul><li>返回一个布尔值，表示某个键是否在当前 Map 对象之中。</li></ul></li> <li>delete(key)
<ul><li>删除某个键，返回true。如果删除失败，返回false。</li></ul></li> <li>clear()
<ul><li>清除所有成员，没有返回值。</li></ul></li></ul> <h4 id="遍历方法"><a href="#遍历方法" aria-hidden="true" class="header-anchor">#</a> 遍历方法</h4> <ul><li>keys()：返回键名的遍历器。</li> <li>values()：返回键值的遍历器。</li> <li>entries()：返回所有成员的遍历器。</li> <li>forEach((value,key,map)=&gt;{})：遍历 Map 的所有成员。
<ul><li>第二个参数，用来绑定this。</li></ul></li></ul> <h4 id="数组的方法间接用于map"><a href="#数组的方法间接用于map" aria-hidden="true" class="header-anchor">#</a> 数组的方法间接用于Map</h4> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">const</span> map0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> map1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token operator">...</span>map0<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> k <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 产生 Map 结构 {1 =&gt; 'a', 2 =&gt; 'b'}</span>

<span class="token keyword">const</span> map2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token operator">...</span>map0<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>k <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'_'</span> <span class="token operator">+</span> v<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 产生 Map 结构 {2 =&gt; '_a', 4 =&gt; '_b', 6 =&gt; '_c'}</span>
</code></pre></div><h3 id="weakmap"><a href="#weakmap" aria-hidden="true" class="header-anchor">#</a> WeakMap</h3> <ul><li>与Map结构类似，但只接受对象作为键名（null除外），不接受其他类型的值作为键名。</li> <li>键名所引用的对象都是弱引用，即垃圾回收机制不将该引用考虑在内。</li> <li>WeakMap 弱引用的只是键名，而不是键值。键值依然是正常引用。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="weakmap-api"><a href="#weakmap-api" aria-hidden="true" class="header-anchor">#</a> WeakMap API</h4> <ul><li>无遍历操作，无size属性，无clear</li> <li>get()</li> <li>set()</li> <li>has()</li> <li>delete()</li></ul> <h4 id="用途-2"><a href="#用途-2" aria-hidden="true" class="header-anchor">#</a> 用途</h4> <ul><li>DOM 节点作为键名</li> <li>一旦这个 DOM 节点删除，该状态就会自动消失，不存在内存泄漏风险。</li> <li>部署私有属性
<ul><li>如果删除实例，它们也就随之消失，不会造成内存泄漏。</li></ul></li></ul> <h2 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> Proxy</h2> <h3 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h3> <ul><li>为了操作对象而提供的新 API</li> <li>表示由它来“代理”某些操作，可以译为“代理器”。（对外界的访问进行过滤和改写）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="参数-4"><a href="#参数-4" aria-hidden="true" class="header-anchor">#</a> 参数</h3> <ul><li>target（所要拦截的目标对象）</li> <li>handler（一个对象，用来定制拦截行为）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">35</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
proxy<span class="token punctuation">.</span>time <span class="token comment">// 35</span>
proxy<span class="token punctuation">.</span>name <span class="token comment">// 35</span>
</code></pre></div><h3 id="注意"><a href="#注意" aria-hidden="true" class="header-anchor">#</a> 注意</h3> <ul><li>必须针对Proxy实例进行操作，而不是针对目标对象进行操作</li> <li>如果handler没有设置任何拦截，那就等同于直接通向原对象。</li> <li>可将 Proxy 对象，设置到object.proxy属性，从而可以在object对象上调用。</li></ul> <h3 id="操作方法"><a href="#操作方法" aria-hidden="true" class="header-anchor">#</a> 操作方法</h3> <ul><li>get(target, propKey, receiver)
<ul><li>拦截对象属性的读取，比如proxy.foo和proxy['foo']。</li></ul></li> <li>set(target, propKey, value, receiver)
<ul><li>拦截对象属性的设置，比如proxy.foo = v或proxy['foo'] = v，返回一个布尔值。</li></ul></li> <li>has(target, propKey)
<ul><li>拦截propKey in proxy的操作，返回一个布尔值。</li></ul></li> <li>construct(target, args)
<ul><li>拦截 Proxy 实例作为构造函数调用的操作，比如new proxy(...args)。</li></ul></li> <li>deleteProperty(target, propKey)
<ul><li>拦截delete proxy[propKey]的操作，返回一个布尔值。</li></ul></li> <li>defineProperty(target, propKey, propDesc)
<ul><li>拦截Object.defineProperty(proxy, propKey, propDesc）、Object.defineProperties(proxy, propDescs)，返回一个布尔值。</li></ul></li> <li>getOwnPropertyDescriptor(target, propKey)
<ul><li>拦截Object.getOwnPropertyDescriptor(proxy, propKey)，返回属性的描述对象。</li></ul></li> <li>getPrototypeOf(target)
<ul><li>拦截Object.getPrototypeOf(proxy)，返回一个对象。</li></ul></li> <li>isExtensible(target)
<ul><li>拦截Object.isExtensible(proxy)，返回一个布尔值。</li></ul></li> <li>ownKeys(target)
<ul><li>拦截Object.getOwnPropertyNames(proxy)、Object.getOwnPropertySymbols(proxy)、Object.keys(proxy)、for...in循环，返回一个数组。该方法返回目标对象所有自身的属性的属性名，而Object.keys()的返回结果仅包括目标对象自身的可遍历属性。</li></ul></li> <li>preventExtensions(target)
<ul><li>拦截Object.preventExtensions(proxy)，返回一个布尔值。</li></ul></li> <li>setPrototypeOf(target, proto)
<ul><li>拦截Object.setPrototypeOf(proxy, proto)，返回一个布尔值。如果目标对象是函数，那么还有两种额外操作可以拦截。</li></ul></li> <li>apply(target, object, args)
<ul><li>拦截 Proxy 实例作为函数调用的操作，比如proxy(...args)、proxy.call(object, ...args)、proxy.apply(...)。</li></ul></li></ul> <h3 id="proxy-revocable"><a href="#proxy-revocable" aria-hidden="true" class="header-anchor">#</a> Proxy.revocable()</h3> <ul><li>返回一个可取消的 Proxy 实例。</li></ul> <h3 id="用途-3"><a href="#用途-3" aria-hidden="true" class="header-anchor">#</a> 用途</h3> <ul><li>Web 服务的客户端</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> service <span class="token operator">=</span> <span class="token function">createWebService</span><span class="token punctuation">(</span><span class="token string">'http://example.com/data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
service<span class="token punctuation">.</span><span class="token function">employees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> employees <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ···</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">createWebService</span><span class="token punctuation">(</span><span class="token parameter">baseUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> propKey<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">httpGet</span><span class="token punctuation">(</span>baseUrl<span class="token operator">+</span><span class="token string">'/'</span> <span class="token operator">+</span> propKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现数据库的 ORM 层</li></ul> <h2 id="reflect"><a href="#reflect" aria-hidden="true" class="header-anchor">#</a> Reflect</h2> <h3 id="概念-4"><a href="#概念-4" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>为了操作对象而提供的新 API</li> <li>Object对象的一些明显属于语言内部的方法，未来的新方法将只部署在Reflect对象上，只有Reflect对象上可以拿到语言内部的方法。</li> <li>修改某些Object方法的返回结果，让其变得更合理。</li> <li>让Object操作都变成函数行为。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 老写法</span>
<span class="token string">'assign'</span> <span class="token keyword">in</span> Object <span class="token comment">// true</span>
<span class="token comment">// 新写法</span>
Reflect<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>Object<span class="token punctuation">,</span> <span class="token string">'assign'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><ul><li>与Proxy对象的方法一一对应，Proxy对象可以方便地调用对应的Reflect方法，完成默认行为。</li></ul> <h3 id="静态方法（大部分与object对象的同名方法的作用相同，而且它与proxy对象的方法是一一对应的。）"><a href="#静态方法（大部分与object对象的同名方法的作用相同，而且它与proxy对象的方法是一一对应的。）" aria-hidden="true" class="header-anchor">#</a> 静态方法（大部分与Object对象的同名方法的作用相同，而且它与Proxy对象的方法是一一对应的。）</h3> <ul><li>Reflect.apply(target, thisArg, args)</li> <li>Reflect.construct(target, args)</li> <li>Reflect.get(target, name, receiver)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><ul><li>Reflect.set(target, name, value, receiver)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>foo <span class="token comment">// 2</span>
</code></pre></div><ul><li>Reflect.defineProperty(target, name, desc)</li> <li>Reflect.deleteProperty(target, name)</li> <li>Reflect.has(target, name)</li> <li>Reflect.ownKeys(target)</li> <li>Reflect.isExtensible(target)</li> <li>Reflect.preventExtensions(target)</li> <li>Reflect.getOwnPropertyDescriptor(target, name)</li> <li>Reflect.getPrototypeOf(target)</li> <li>Reflect.setPrototypeOf(target, prototype)</li></ul> <h3 id="使用-proxy-实现观察者模式"><a href="#使用-proxy-实现观察者模式" aria-hidden="true" class="header-anchor">#</a> 使用 Proxy 实现观察者模式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">observe</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span>
<span class="token comment">// 输出</span>
<span class="token comment">// 李四, 20</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> queuedObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">observe</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=&gt;</span> queuedObservers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">observable</span> <span class="token operator">=</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">set</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  queuedObservers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="promise对象"><a href="#promise对象" aria-hidden="true" class="header-anchor">#</a> Promise对象</h2> <h3 id="概念-5"><a href="#概念-5" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>Promise 是一个对象，从它可以获取异步操作的消息。</li> <li>特点
<ul><li>promise对象的异步操作的三种状态:pending（进行中）、fulfilled（已成功）和rejected（已失败）</li> <li>状态改变：<code>从pending变为fulfilled</code>和<code>从pending变为rejected</code></li></ul></li></ul> <h3 id="参数-5"><a href="#参数-5" aria-hidden="true" class="header-anchor">#</a> 参数</h3> <ul><li>一个函数（函数参数resolve和reject，由js引擎提供，不用自己部署）
<ul><li>resolve
<ul><li>将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；</li></ul></li> <li>reject
<ul><li>将Promise对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 某异步操作 */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* 异步操作成功 */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="构造函数方法-2"><a href="#构造函数方法-2" aria-hidden="true" class="header-anchor">#</a> 构造函数方法</h3> <ul><li><p>Promise()</p></li> <li><p>Promise.all([p1,p2,p3])</p> <ul><li>所有成员返回成功才会成功，有一个失败就失败</li> <li>将多个 Promise 实例，包装成一个新的 Promise 实例</li> <li>参数是具有 Iterator 接口的对象，且每个成员都是Promise实例(不是会自使用resolve转)</li> <li>如果作为参数的 Promise 实例，自己定义了catch方法，那么它一旦被rejected，并不会触发Promise.all()的catch方法。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'报错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Error: 报错了</span>
</code></pre></div></li> <li><p>Promise.race([p1,p2,p3])</p> <ul><li>将多个 Promise 实例，包装成一个新的 Promise 实例。</li> <li>参数是具有 Iterator 接口的对象，且每个成员都是Promise实例(不是会自使用resolve转)</li> <li>只要有一个参数promise状态改变，就产生结果</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/resource-that-may-take-a-while'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'request timeout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Promise.resolve()
<ul><li>将现有对象转为 状态为resolved 的Promise 对象</li> <li>then会立即执行</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>四种参数
<ul><li>参数是一个 Promise 实例（直接返回这个实例）</li> <li>参数是一个thenable对象（将这个对象转为 Promise 对象，然后立即执行thenable对象的then方法。）</li> <li>参数不是具有then方法的对象，或根本就不是对象（则Promise.resolve方法返回一个新的 Promise 对象，状态为resolved。）</li> <li>不带有任何参数（返回一个resolved状态的 Promise 对象。）</li></ul> <div class="warning custom-block"><p class="custom-block-title">快速得到一个promise对象</p> <p>希望得到一个 Promise 对象，比较方便的方法就是直接调用Promise.resolve()方法。</p></div></li></ul></li> <li>Promise.reject(reason)
<ul><li>返回一个状态为rejected的Promise 实例</li> <li>回调函数立即执行</li> <li>参数会作为reject的理由，变成后续方法的参数。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 出错了</span>
</code></pre></div><h3 id="实例方法-2"><a href="#实例方法-2" aria-hidden="true" class="header-anchor">#</a> 实例方法</h3> <ul><li>Promise.prototype.then()
<ul><li>参数1(回调函数)：状态变为resolved时调用</li> <li>参数2(回调函数)：状态变为rejected时调用</li> <li>返回的是一个新的Promise实例（可以链式调用,第一个then方法指定的回调函数，返回的是另一个Promise对象。）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/post/1.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">post</span> <span class="token operator">=&gt;</span> <span class="token function">getJSON</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>commentURL<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">comments</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;resolved: &quot;</span><span class="token punctuation">,</span> comments<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;rejected: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Promise.prototype.catch()
<ul><li>指定发生错误时的回调函数</li> <li>.then(null, rejection)或.then(undefined, rejection)的别名</li> <li>建议使用catch方法，而不使用then方法的第二个参数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/posts.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">posts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理 getJSON 和 前一个回调函数运行时发生的错误</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生错误！'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>Promise.prototype.finally() [ES2018]
<ul><li>指定不管 Promise 对象最后状态如何，都会执行的操作。(本质上是then方法的特例)</li></ul> <div class="language-JS extra-class"><pre class="language-js"><code>promise
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>···<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="promise实现一个ajax操作"><a href="#promise实现一个ajax操作" aria-hidden="true" class="header-anchor">#</a> Promise实现一个Ajax操作</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getJSON</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">!==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">&quot;/posts.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Contents: '</span> <span class="token operator">+</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="应用"><a href="#应用" aria-hidden="true" class="header-anchor">#</a> 应用</h3> <ul><li>加载图片
<ul><li>将图片的加载写成一个Promise，一旦加载完成，Promise的状态就发生变化。</li></ul></li> <li>Generator 函数与 Promise 的结合</li> <li>同步和异步同样处理
<ul><li>Promise.try提案</li></ul></li></ul> <h2 id="iterator和for-of循环"><a href="#iterator和for-of循环" aria-hidden="true" class="header-anchor">#</a> Iterator和for..of循环</h2> <h3 id="概念-6"><a href="#概念-6" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>统一的接口机制，来处理所有不同的数据结构（Array,Object,Map,Set）。任何数据结构只要部署 Iterator 接口，就可以完成遍历操作<code>for...of</code></li></ul> <h3 id="iterator接口"><a href="#iterator接口" aria-hidden="true" class="header-anchor">#</a> Iterator接口</h3> <ul><li>一个数据结构只要具有Symbol.iterator属性，就可以认为是“可遍历的”（iterable）（Symbol.iterator属性名是symbol内置对象，属性值是个函数，执行这个函数，就会返回一个遍历器。）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          done<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="具备iterator接口的数据结构"><a href="#具备iterator接口的数据结构" aria-hidden="true" class="header-anchor">#</a> 具备Iterator接口的数据结构</h3> <ul><li>Array</li> <li>Map</li> <li>Set</li> <li>String</li> <li>TypedArray</li> <li>函数的 arguments 对象</li> <li>NodeList 对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 手动遍历</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iter <span class="token operator">=</span> arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'a', done: false }</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'b', done: false }</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'c', done: false }</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: undefined, done: true }</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">类数组（存在数值键名和length属性）部署 Iterator 接口</p> <p>Symbol.iterator方法引用数组的 Iterator 接口。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> iterable <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span>
  length<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> iterable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'a', 'b', 'c'</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="调用iterator接口的场合"><a href="#调用iterator接口的场合" aria-hidden="true" class="header-anchor">#</a> 调用Iterator接口的场合</h3> <ul><li>任何接受数组作为参数的场合（数组的遍历会调用遍历器接口）
<ul><li>for...of</li> <li>Array.from()</li> <li>Map(), Set(), WeakMap(), WeakSet()（比如new Map([['a',1],['b',2]])）</li> <li>Promise.all()</li> <li>Promise.race()</li></ul></li> <li>解构赋值</li> <li>扩展运算符</li> <li>yield*</li></ul> <h3 id="遍历器对象部署的方法"><a href="#遍历器对象部署的方法" aria-hidden="true" class="header-anchor">#</a> 遍历器对象部署的方法</h3> <ul><li>next()</li> <li>return
<ul><li>如果for...of循环提前退出（通常是因为出错，或者有break语句），就会调用return方法。(如果一个对象在完成遍历前，需要清理或释放资源，就可以部署return方法。)</li></ul></li> <li>throw
<ul><li>配合 Generator 函数使用</li></ul></li></ul> <h3 id="for-of循环"><a href="#for-of循环" aria-hidden="true" class="header-anchor">#</a> for...of循环</h3> <ul><li>数组
<ul><li>代替forEach方法</li> <li>for...in循环读取键名，for...of循环读取键值</li> <li>for...in返回所有属性，for...of只返回具有数字索引的属性</li></ul></li> <li>Set和Map
<ul><li>遍历的顺序是按照各个成员被添加进数据结构的顺序</li> <li>Set 结构遍历时，返回的是一个值， Map 结构遍历时，返回的是一个数组(数组的两个成员分别为当前 Map 成员的键名和键值)</li></ul></li></ul> <div class="warning custom-block"><p class="custom-block-title">遍历语法总结</p> <ul><li>for循环（麻烦）</li> <li>forEach(无法中途跳出循环，break和return都无效)</li> <li>for...in(遍历键名)
<ul><li>会遍历手动添加的其他键，甚至包括原型链上的键。</li> <li>可能会以任意顺序遍历键名。</li></ul></li> <li>for...of
<ul><li>语法简洁，没有for...in的缺点。</li> <li>可以与break、continue和return配合使用。</li> <li>提供了遍历所有数据结构的统一操作接口。</li></ul></li></ul></div> <h2 id="generator-函数的语法"><a href="#generator-函数的语法" aria-hidden="true" class="header-anchor">#</a> Generator 函数的语法</h2> <h3 id="概念-7"><a href="#概念-7" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>状态机，封装了多个内部状态</li> <li>调用后返回一个遍历器对象（遍历器生成函数），可以依次遍历 Generator 函数内部的每一个状态。</li> <li>function关键字与函数名之间有一个星号(没有规定是哪个位置)，函数体内部使用yield表达式（定义不同的内部状态）</li> <li>分段执行，调用遍历器对象的next方法进入下一个状态（yield表达式是暂停执行的标记）</li> <li>next()
<ul><li>遇到yiedl或者return返回一个有value(内部状态的值)和done(是否遍历结束)属性的对象。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> hw <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: 'hello', done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: 'world', done: false }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: 'ending', done: true }</span>
hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// { value: undefined, done: true }</span>
</code></pre></div><h4 id="yield表达式"><a href="#yield表达式" aria-hidden="true" class="header-anchor">#</a> yield表达式</h4> <ul><li>yield表达式只能用在 Generator 函数里面</li> <li>yiedl具备记忆位置功能，return不具备</li> <li>如果用在另一个表达式之中，必须放在圆括号里面。</li> <li>用作函数参数或放在赋值表达式的右边，可以不加括号。</li></ul> <h4 id="iterator接口赋值generator"><a href="#iterator接口赋值generator" aria-hidden="true" class="header-anchor">#</a> Iterator接口赋值Generator</h4> <ul><li>可以把 Generator 赋值给对象的Symbol.iterator属性(Generator 函数就是遍历器生成函数)</li></ul> <h3 id="next-方法"><a href="#next-方法" aria-hidden="true" class="header-anchor">#</a> next()方法</h3> <ul><li>带一个参数，该参数就会被当作上一个yield表达式的返回值。</li></ul> <h3 id="构造函数"><a href="#构造函数" aria-hidden="true" class="header-anchor">#</a> 构造函数</h3> <ul><li>Generator.prototype.throw()
<ul><li>在函数体外抛出错误，然后在 Generator 函数体内捕获。</li> <li>接受一个参数，该参数会被catch语句接收，建议抛出Error对象的实例。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">g</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'内部捕获'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'外部捕获'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 内部捕获 a</span>
<span class="token comment">// 外部捕获 b</span>
</code></pre></div><ul><li>Generator.prototype.return()
<ul><li>返回给定的值(参数)，并且终结遍历 Generator 函数。</li></ul></li></ul> <div class="warning custom-block"><p class="custom-block-title">next(),throw(),return</p> <ul><li>让 Generator 函数恢复执行，并且使用不同的语句替换yield表达式。
<ul><li>next()是将yield表达式替换成一个值。</li> <li>throw()是将yield表达式替换成一个throw语句。</li> <li>return()是将yield表达式替换成一个return语句。</li></ul></li></ul></div> <h3 id="generator函数里执行generator函数。"><a href="#generator函数里执行generator函数。" aria-hidden="true" class="header-anchor">#</a> Generator函数里执行Generator函数。</h3> <ul><li>yiedl* 表达式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'x'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'y'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'x'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'a'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'b'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'y'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等同于</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'x'</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">yield</span> <span class="token string">'y'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;x&quot;</span>
<span class="token comment">// &quot;a&quot;</span>
<span class="token comment">// &quot;b&quot;</span>
<span class="token comment">// &quot;y&quot;</span>
</code></pre></div><h3 id="作为对象属性"><a href="#作为对象属性" aria-hidden="true" class="header-anchor">#</a> 作为对象属性</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span> <span class="token function">myGeneratorMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ···
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">myGeneratorMethod</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ···</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="作为状态机"><a href="#作为状态机" aria-hidden="true" class="header-anchor">#</a> 作为状态机</h3> <ul><li>Generator 是实现状态机的最佳结构。</li> <li>不用外部变量保存状态，因为它本身就包含了一个状态信息（目前是否处于暂停态）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES5状态机</span>
<span class="token keyword">var</span> ticking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">clock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ticking<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tick!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tock!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ticking <span class="token operator">=</span> <span class="token operator">!</span>ticking<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Generator状态机</span>
<span class="token keyword">var</span> <span class="token function-variable function">clock</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tick!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tock!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="应用（可以暂停函数执行，返回任意表达式的值。）"><a href="#应用（可以暂停函数执行，返回任意表达式的值。）" aria-hidden="true" class="header-anchor">#</a> 应用（可以暂停函数执行，返回任意表达式的值。）</h3> <ul><li>异步操作的同步化表达<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;http://some.url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">makeAjaxCall</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> it <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li>控制流管理</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Promise实现</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>step1<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>step4<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with value4</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any error from step1 through step4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Generator改善</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">longRunningTask</span><span class="token punctuation">(</span><span class="token parameter">value1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step1</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value3 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step2</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value4 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step3</span><span class="token punctuation">(</span>value3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> value5 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">step4</span><span class="token punctuation">(</span>value4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do something with value4</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any error from step1 through step4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>部署 Iterator 接口</li> <li>作为数据结构
<ul><li>可以看作是一个数组结构<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'hello.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'world.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'and-such.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 像数组一样用for of遍历</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>task <span class="token keyword">of</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// task是一个函数，可以像回调函数那样使用它</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h2 id="generator-函数的异步应用"><a href="#generator-函数的异步应用" aria-hidden="true" class="header-anchor">#</a> Generator 函数的异步应用</h2> <h3 id="es5的异步处理方法"><a href="#es5的异步处理方法" aria-hidden="true" class="header-anchor">#</a> ES5的异步处理方法</h3> <ul><li>回调函数</li> <li>事件监听</li> <li>发布/订阅</li> <li>Promise 对象
<ul><li>不是新的语法功能，而是一种新的写法，允许将回调函数的嵌套，改成链式调用。</li> <li>代码冗余（原来的任务被 Promise 包装了一下，不管什么操作，一眼看去都是一堆then）原来的语义变得很不清楚。</li></ul></li></ul> <h3 id="传统异步编程的解决方案（多任务的解决方案）协程"><a href="#传统异步编程的解决方案（多任务的解决方案）协程" aria-hidden="true" class="header-anchor">#</a> 传统异步编程的解决方案（多任务的解决方案）协程</h3> <ul><li>概念
<ul><li>第一步，协程A开始执行。</li> <li>第二步，协程A执行到一半，进入暂停，执行权转移到协程B。</li> <li>第三步，（一段时间后）协程B交还执行权。</li> <li>第四步，协程A恢复执行</li></ul></li></ul> <h3 id="协程在es6中的实现（generator-函数）"><a href="#协程在es6中的实现（generator-函数）" aria-hidden="true" class="header-anchor">#</a> 协程在ES6中的实现（Generator 函数）</h3> <ul><li>可以交出函数的执行权（即暂停执行）。
<ul><li>Generator 函数就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用yield语句注明。</li></ul></li></ul> <h3 id="co模块"><a href="#co模块" aria-hidden="true" class="header-anchor">#</a> co模块</h3> <ul><li>自动执行Genrerator函数
<ul><li>接受 Generator 函数作为参数，返回一个 Promise 对象。</li> <li>源码：利用递归执行next不停进行then回调</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> f1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/fstab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> f2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/shells'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">co</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">co</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Generator 函数执行完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// co源码</span>
<span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> gen <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gen <span class="token operator">||</span> <span class="token keyword">typeof</span> gen<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> gen <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> gen <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gen <span class="token operator">||</span> <span class="token keyword">typeof</span> gen<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> ret<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">ret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token function">toPromise</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token function">isPromise</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>
      <span class="token string">'You may only yield a function, promise, generator, array, or object, '</span>
      <span class="token operator">+</span> <span class="token string">'but the following object was passed: &quot;'</span>
      <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>ret<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token operator">+</span> <span class="token string">'&quot;'</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>支持并发的异步操作
<ul><li>要把并发的操作都放在数组或对象里面，跟在yield语句后面。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 数组的写法</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">[</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对象的写法</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">{</span>
    <span class="token number">1</span><span class="token punctuation">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="async函数"><a href="#async函数" aria-hidden="true" class="header-anchor">#</a> async函数</h2> <h3 id="是-generator-函数的语法糖。"><a href="#是-generator-函数的语法糖。" aria-hidden="true" class="header-anchor">#</a> 是 Generator 函数的语法糖。</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Generator</span>
<span class="token keyword">const</span> <span class="token function-variable function">gen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/fstab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> f2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/shells'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// async</span>
<span class="token keyword">const</span> <span class="token function-variable function">asyncReadFile</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> f1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/fstab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> f2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/etc/shells'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>改善
<ul><li>内置执行器（Generator 函数，需要调用next方法，或者用co模块，才能真正执行）。</li> <li>更好的语义</li> <li>更广的适用性（await后可以是 Promise 对象和原始类型的值，co模块的yield后只能是Thunk函数或Promise对象）</li> <li>返回值是Promise(Generator 函数的返回值是 Iterator 对象)</li> <li>z总之：async函数完全可以看作多个异步操作，包装成的一个 Promise 对象，而await命令就是内部then命令的语法糖。</li></ul></li></ul> <h3 id="基本用法"><a href="#基本用法" aria-hidden="true" class="header-anchor">#</a> 基本用法</h3> <ul><li>async函数返回一个 Promise 对象，可以使用then方法添加回调函数。当函数执行的时候，一旦遇到await就会先返回，等到异步操作完成，再接着执行函数体内后面的语句。</li> <li>async函数内部的异步操作执行完，才会执行then方法指定的回调函数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> html<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/&lt;title&gt;([\s\S]+)&lt;\/title&gt;/i</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token string">'https://tc39.github.io/ecma262/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>
<span class="token comment">// &quot;ECMAScript 2017 Language Specification&quot;</span>
</code></pre></div><h3 id="await命令"><a href="#await命令" aria-hidden="true" class="header-anchor">#</a> await命令</h3> <ul><li>await命令后面是一个 Promise 对象，返回该对象的结果。如果不是 Promise 对象，就直接返回对应的值。</li> <li>错误处理
<ul><li>将其放在try...catch代码块之中</li> <li>有多个await命令，可以统一放在try...catch结构中。</li></ul></li> <li>注意点
<ul><li>最好把await命令放在try...catch代码块中。（await命令后面的Promise对象，运行结果可能是rejected）</li> <li>多个await命令后面的异步操作，如果不存在继发关系，最好让它们同时触发。<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 多个await</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写法一</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写法二</span>
<span class="token keyword">let</span> fooPromise <span class="token operator">=</span> <span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> barPromise <span class="token operator">=</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> fooPromise<span class="token punctuation">;</span>
<span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> barPromise<span class="token punctuation">;</span>
</code></pre></div></li> <li>await命令只能用在async函数之中
<ul><li>如果将forEach方法的参数改成async函数，也有问题。正确的写法是采用for循环。</li></ul></li> <li>async 函数可以保留运行堆栈。</li></ul></li></ul> <h3 id="async函数实现原理"><a href="#async函数实现原理" aria-hidden="true" class="header-anchor">#</a> async函数实现原理</h3> <ul><li>将 Generator 函数和自动执行器，包装在一个函数里。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="扩展运算符…"><a href="#扩展运算符…" aria-hidden="true" class="header-anchor">#</a> 扩展运算符<code>…</code></h2> <ul><li><code>...</code>的作用就是删掉外面的{}</li></ul> <h3 id="用于对象的展开-es7"><a href="#用于对象的展开-es7" aria-hidden="true" class="header-anchor">#</a> 用于对象的展开(es7)</h3> <h3 id="用于数组的展开"><a href="#用于数组的展开" aria-hidden="true" class="header-anchor">#</a> 用于数组的展开</h3> <h3 id="用于剩余运算符"><a href="#用于剩余运算符" aria-hidden="true" class="header-anchor">#</a> 用于剩余运算符</h3> <h2 id="class-的基本语法"><a href="#class-的基本语法" aria-hidden="true" class="header-anchor">#</a> Class 的基本语法</h2> <h3 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h3> <h4 id="生成实例对象的传统方法是通过构造函数。"><a href="#生成实例对象的传统方法是通过构造函数。" aria-hidden="true" class="header-anchor">#</a> 生成实例对象的传统方法是通过构造函数。</h4> <h4 id="es6引入了-class（类）这个概念，作为对象的模板。【只是一个语法糖】"><a href="#es6引入了-class（类）这个概念，作为对象的模板。【只是一个语法糖】" aria-hidden="true" class="header-anchor">#</a> ES6引入了 Class（类）这个概念，作为对象的模板。【只是一个语法糖】</h4> <ul><li>与ES5一致的
<ul><li>让对象原型的写法更加清晰、更像面向对象编程的语法。不需要加上function这个关键字,方法之间不需要逗号分隔(构造函数的另一种写法)</li> <li>类的数据类型就是函数，类本身就指向构造函数。</li> <li>使用也是对类使用new命令</li> <li>类的所有方法都定义在类的prototype属性上面。(Object.assign方法一次向类添加多个方法)</li> <li>prototype对象的constructor属性，直接指向“类”的本身，</li></ul></li> <li>与ES5不一致的
<ul><li>类的内部所有定义的方法，都是不可枚举的</li> <li>类必须使用new调用，否则会报错（普通构造函数不用new也可以执行）</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ES5</span>
<span class="token keyword">function</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ES6</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">typeof</span> Point <span class="token comment">// &quot;function&quot;</span>
Point <span class="token operator">===</span> <span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token comment">// true</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token function">toValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 等同于</span>
<span class="token class-name">Point</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="constructor【与es5一致】"><a href="#constructor【与es5一致】" aria-hidden="true" class="header-anchor">#</a> constructor【与ES5一致】</h4> <ul><li>默认方法，如果定义，会添加一个空的constructor方法。（通过new命令生成对象实例时，自动调用该方法。）</li> <li>默认返回实例对象（即this），可以指定返回另外一个对象。</li></ul> <h4 id="类的实例【与es5一致】"><a href="#类的实例【与es5一致】" aria-hidden="true" class="header-anchor">#</a> 类的实例【与ES5一致】</h4> <ul><li>使用new命令</li> <li>实例的属性除非显式定义在其本身（this对象上），否则都是定义在原型上（class上）。</li></ul> <h4 id="取值函数（getter）和存值函数（setter）【与es5一致】"><a href="#取值函数（getter）和存值函数（setter）【与es5一致】" aria-hidden="true" class="header-anchor">#</a> 取值函数（getter）和存值函数（setter）【与ES5一致】</h4> <ul><li>对某个属性设置存值函数和取值函数，拦截该属性的存取行为。
<ul><li>存值函数和取值函数是设置在属性的 Descriptor 对象上的。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">prop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'getter'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">prop</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setter: '</span><span class="token operator">+</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> inst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inst<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token comment">// setter: 123</span>
inst<span class="token punctuation">.</span>prop
<span class="token comment">// 'getter'</span>
</code></pre></div><h4 id="属性表达式"><a href="#属性表达式" aria-hidden="true" class="header-anchor">#</a> 属性表达式</h4> <ul><li>类的属性名，可以采用表达式。</li></ul> <h4 id="class用表达式形式定义"><a href="#class用表达式形式定义" aria-hidden="true" class="header-anchor">#</a> Class用表达式形式定义</h4> <ul><li>类的名字只在 Class 的内部可用，指代当前类。在 Class 外部，只能用变量名引用。</li> <li>可简写省略名字</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MyClass <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Me</span> <span class="token punctuation">{</span>
  <span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Me<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MyClass <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="注意-2"><a href="#注意-2" aria-hidden="true" class="header-anchor">#</a> 注意</h4> <ul><li>类和模块的内部，默认是严格模式</li> <li>类不存在变量提升（hoist）</li> <li>类函数的许多特性都被Class继承，包括name属性</li> <li>如果某个方法之前加上星号（*），就表示该方法是一个 Generator 函数。</li> <li>类的方法内部如果含有this，它默认指向类的实例。</li></ul> <h3 id="静态方法（不会被实例继承，而是直接通过类来调用）"><a href="#静态方法（不会被实例继承，而是直接通过类来调用）" aria-hidden="true" class="header-anchor">#</a> 静态方法（不会被实例继承，而是直接通过类来调用）</h3> <ul><li>在一个方法前，加上static关键字</li></ul> <h3 id="静态属性"><a href="#静态属性" aria-hidden="true" class="header-anchor">#</a> 静态属性()</h3> <ul><li>ES6 明确规定，Class 内部只有静态方法，没有静态属性。只能采取这种方法</li> <li>有提案提供像静态方法一样的static关键字</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
Foo<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Foo<span class="token punctuation">.</span>prop <span class="token comment">// 1</span>
</code></pre></div><h3 id="实例属性"><a href="#实例属性" aria-hidden="true" class="header-anchor">#</a> 实例属性</h3> <ul><li>定义
<ul><li>定义在constructor()方法里面</li> <li>定义在类的最顶层（这时，不需要在实例属性前面加上this。）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">IncreasingCounter</span> <span class="token punctuation">{</span>
  _count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Getting the current value!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="私有方法和私有属性"><a href="#私有方法和私有属性" aria-hidden="true" class="header-anchor">#</a> 私有方法和私有属性</h3> <ul><li>只能在类的内部访问的方法和属性，外部不能访问。</li> <li>ES6 不提供，可以采取以下三种方法模拟实现，（#语法目前在提案中）
<ul><li>在命名上加以区别。</li> <li>将私有方法移出模块</li> <li>利用Symbol值的唯一性，将私有方法的名字命名为一个Symbol值。</li></ul></li></ul> <h3 id="new-target-属性"><a href="#new-target-属性" aria-hidden="true" class="header-anchor">#</a> new.target 属性</h3> <ul><li>用在构造函数之中，返回new命令作用于的那个构造函数。</li> <li>如果构造函数不是通过new命令或Reflect.construct()调用的，new.target会返回undefined，</li> <li>可以用来确定构造函数是怎么调用的。</li></ul> <h2 id="class-的继承"><a href="#class-的继承" aria-hidden="true" class="header-anchor">#</a> Class 的继承</h2> <h3 id="简介-2"><a href="#简介-2" aria-hidden="true" class="header-anchor">#</a> 简介</h3> <ul><li>通过extends关键字实现继承</li> <li>super关键字表示父类的构造函数</li> <li>子类必须在constructor方法中调用super方法
<ul><li>子类自己的this对象，必须先通过父类的构造函数完成塑造，得到与父类同样的实例属性和方法，然后再对其进行加工，加上子类自己的实例属性和方法。如果不调用super方法，子类就得不到this对象。</li></ul> <div class="warning custom-block"><p class="custom-block-title">ES5继承和ES6继承区别</p> <ul><li>ES5 先创造子类的实例对象this，然后再将父类的方法添加到this上面（Parent.apply(this)）。</li> <li>ES6 先将父类实例对象的属性和方法，加到this上面，然后再用子类的构造函数修改this。</li></ul></div></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ColorPoint</span> <span class="token keyword">extends</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用父类的constructor(x, y)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用父类的toString()</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="获取父类"><a href="#获取父类" aria-hidden="true" class="header-anchor">#</a> 获取父类</h3> <ul><li>判断一个类是否继承了另一个类。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>ColorPoint<span class="token punctuation">)</span> <span class="token operator">===</span> Point
<span class="token comment">// true</span>
</code></pre></div><h3 id="super-关键字-2"><a href="#super-关键字-2" aria-hidden="true" class="header-anchor">#</a> super 关键字</h3> <ul><li>作为函数，代表父类的构造函数，用来继承父类方法</li> <li>作为对象
<ul><li>在普通方法中，指向父类的原型对象；在静态方法中，指向父类。</li></ul></li></ul> <h3 id="类的-prototype-属性和-proto-属性"><a href="#类的-prototype-属性和-proto-属性" aria-hidden="true" class="header-anchor">#</a> 类的 prototype 属性和__proto__属性</h3> <ul><li>作为构造函数的语法糖，同时有prototype属性和__proto__属性，因此同时存在两条继承链。
<ul><li>子类的__proto__属性，表示构造函数的继承，总是指向父类。</li> <li>子类prototype属性的__proto__属性，表示方法的继承，总是指向父类的prototype属性。</li></ul></li></ul> <h3 id="原生构造函数（js内置构造函数）的继承"><a href="#原生构造函数（js内置构造函数）的继承" aria-hidden="true" class="header-anchor">#</a> 原生构造函数（js内置构造函数）的继承</h3> <ul><li>原生构造函数是指语言内置的构造函数，通常用来生成数据结构。
<ul><li>Boolean()</li> <li>Number()</li> <li>String()</li> <li>Array()</li> <li>Date()</li> <li>Function()</li> <li>RegExp()</li> <li>Error()</li> <li>Object()</li></ul></li></ul> <h3 id="mixin模式的实现"><a href="#mixin模式的实现" aria-hidden="true" class="header-anchor">#</a> Mixin模式的实现</h3> <ul><li>Mixin
<ul><li>多个对象合成一个新的对象，新对象具有各个组成成员的接口。</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将多个类的接口“混入”（mix in）另一个类。</span>
<span class="token keyword">function</span> <span class="token function">mix</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>mixins</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Mix</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> mixin <span class="token keyword">of</span> mixins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拷贝实例属性</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> mixin <span class="token keyword">of</span> mixins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">copyProperties</span><span class="token punctuation">(</span>Mix<span class="token punctuation">,</span> mixin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拷贝静态属性</span>
    <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token class-name">Mix</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> mixin<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拷贝原型属性</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Mix<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> Reflect<span class="token punctuation">.</span><span class="token function">ownKeys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> key <span class="token operator">!==</span> <span class="token string">'constructor'</span>
      <span class="token operator">&amp;&amp;</span> key <span class="token operator">!==</span> <span class="token string">'prototype'</span>
      <span class="token operator">&amp;&amp;</span> key <span class="token operator">!==</span> <span class="token string">'name'</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> desc <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="module的语法"><a href="#module的语法" aria-hidden="true" class="header-anchor">#</a> Module的语法</h2> <h3 id="概述-2"><a href="#概述-2" aria-hidden="true" class="header-anchor">#</a> 概述</h3> <ul><li>ES6之前，CommonJS 和 AMD 两种。前者用于服务器，后者用于浏览器。</li> <li>ES6 在语言标准的层面上，实现了模块功能，而且得相当简单，完全可以取代 CommonJS 和 AMD 规范，成为浏览器和服务器通用的模块解决方案。</li></ul> <div class="warning custom-block"><p class="custom-block-title">区别</p> <ul><li>CMD和AMD运行时才能确定模块的依赖关系，输入时必须查找对象属性，而ES6编译时就能确定</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// CommonJS模块(整体加载fs模块（即加载fs的所有方法），生成一个对象（_fs），然后再从这个对象上面读取 3 个方法。</span>
<span class="token comment">// “运行时加载”，因为只有运行时才能得到这个对象)</span>
<span class="token comment">// CommonJS 模块输出的是值的缓存，不存在动态更新，</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> stat<span class="token punctuation">,</span> exists<span class="token punctuation">,</span> readFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ES6模块(从fs模块加载 3 个方法，其他方法不加载。</span>
<span class="token comment">// “编译时加载”或者静态加载,编译时就完成模块加载)</span>
<span class="token comment">// 值动态更新</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> stat<span class="token punctuation">,</span> exists<span class="token punctuation">,</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
</code></pre></div></div> <ul><li>ES6模块优点
<ul><li>静态加载</li> <li>不再需要UMD模块格式了，将来服务器和浏览器都会支持 ES6 模块格式。</li> <li>将来浏览器的新 API 就能用模块格式提供</li> <li>不再需要对象作为命名空间（比如Math对象），可以通过模块提供。</li></ul></li> <li>注意
<ul><li>ES6的模块自动采用严格模式</li> <li>ES6模块中，顶层的this指向undefined(不应该在顶层代码使用this)</li></ul></li></ul> <h3 id="export命令"><a href="#export命令" aria-hidden="true" class="header-anchor">#</a> export命令</h3> <ul><li>一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。如果希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</li> <li>可使用as重命名</li> <li>export命令规定的是对外的接口，所以输出的必须是接口（必须在接口名与模块内部变量之间建立一一对应的关系，通过接口取到值，而不能直接输出值）</li> <li>export语句输出的接口，与其对应的值是动态绑定关系（通过该接口，可以取到模块内部实时的值）</li> <li>export命令可以出现在模块的任何位置，只要处于模块顶层就可以。如果处于块级作用域内，就会报错</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 写法一</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> firstName <span class="token operator">=</span> <span class="token string">'Michael'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> lastName <span class="token operator">=</span> <span class="token string">'Jackson'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">*</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 写法二（优先考虑）</span>
<span class="token keyword">var</span> firstName <span class="token operator">=</span> <span class="token string">'Michael'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> lastName <span class="token operator">=</span> <span class="token string">'Jackson'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">v1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> v1 <span class="token keyword">as</span> streamV1 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 报错</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> m<span class="token punctuation">;</span>
<span class="token comment">// 报错</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> f<span class="token punctuation">;</span>
<span class="token comment">// 写法一</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 写法二</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>m<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 写法三</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>n <span class="token keyword">as</span> m<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 正确</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 正确</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>f<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> foo <span class="token operator">=</span> <span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出变量foo，值为bar，500毫秒后变成baz</span>
</code></pre></div><h3 id="import命令"><a href="#import命令" aria-hidden="true" class="header-anchor">#</a> import命令</h3> <ul><li>接受一对大括号，里面指定要从其他模块导入的变量名。大括号里面的变量名，必须与被导入模块对外接口的名称相同。</li> <li>使用as关键字，将输入的变量重命名。</li> <li>输入的变量是只读的(不允许在加载模块的脚本里面，改写接口。但对象的属性是可以改写的。改写后其他模块也能读取，所以很难查错)</li> <li>from，位置，.js后缀可以省略，只是模块名，必须有配置文件，告诉js引擎该模块的位置</li> <li>import命令具有提升效果，会提升到整个模块的头部，首先执行。</li> <li>import是静态执行，所以不能使用表达式和变量（运行时才能得到结果的语法）</li> <li>没有from,import语句会执行所加载的模块</li> <li>多次重复执行同一句import语句，只会执行一次</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> firstName<span class="token punctuation">,</span> lastName<span class="token punctuation">,</span> year <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./profile.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> lastName <span class="token keyword">as</span> surname <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./profile.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  element<span class="token punctuation">.</span>textContent <span class="token operator">=</span> firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> lastName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="模块的整体加载"><a href="#模块的整体加载" aria-hidden="true" class="header-anchor">#</a> 模块的整体加载</h3> <ul><li>用星号（*）指定一个对象，所有输出值都加载在这个对象上面。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// circle.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> circle <span class="token keyword">from</span> <span class="token string">'./circle'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'圆面积：'</span> <span class="token operator">+</span> circle<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'圆周长：'</span> <span class="token operator">+</span> circle<span class="token punctuation">.</span><span class="token function">circumference</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="export-default命令"><a href="#export-default命令" aria-hidden="true" class="header-anchor">#</a> export default命令</h3> <ul><li>import命令后面，不使用大括号。可以指定任意名字。</li> <li>无需知道模块里有哪些属性和方法即可加载模块。</li> <li>本质是将后面的值，赋给default变量，然后系统允许你为它取任意名字。
<ul><li>后面不能跟变量声明语句</li> <li>可以直接将一个值写在export default之后。</li> <li>可以同时输入默认方法和其他接口</li> <li>可以用来输出类</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// export-default.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">each</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> iterator<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ···</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> each <span class="token keyword">as</span> forEach <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import-default.js</span>
<span class="token keyword">import</span> customName <span class="token keyword">from</span> <span class="token string">'./export-default'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> _<span class="token punctuation">,</span> <span class="token punctuation">{</span> each<span class="token punctuation">,</span> forEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token function">customName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'foo'</span>
</code></pre></div><h3 id="export-与-import-的复合写法"><a href="#export-与-import-的复合写法" aria-hidden="true" class="header-anchor">#</a> export 与 import 的复合写法</h3> <ul><li>如果在一个模块之中，先输入后输出同一个模块，import语句可以与export语句写在一起。</li> <li>写成一行以后，foo和bar实际上并没有被导入当前模块，只是相当于对外转发了这两个接口，导致当前模块不能直接使用foo和bar。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'my_module'</span><span class="token punctuation">;</span>

<span class="token comment">// 可以简单理解为</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'my_module'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>模块接口改名</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> foo <span class="token keyword">as</span> myFoo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'my_module'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>整体输出</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'my_module'</span><span class="token punctuation">;</span>
<span class="token comment">// 默认接口</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>具名接口改为默认接口</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> es6 <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./someModule'</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> es6 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./someModule'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> es6<span class="token punctuation">;</span>
</code></pre></div><ul><li>默认接口改名为具名接口</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> es6 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./someModule'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>下面三种import语句，没有对应的复合写法。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> someIdentifier <span class="token keyword">from</span> <span class="token string">&quot;someModule&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> someIdentifier <span class="token keyword">from</span> <span class="token string">&quot;someModule&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> someIdentifier<span class="token punctuation">,</span> <span class="token punctuation">{</span> namedIdentifier <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;someModule&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="模块的继承"><a href="#模块的继承" aria-hidden="true" class="header-anchor">#</a> 模块的继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// circleplus.js</span>
<span class="token comment">// 继承了circle模块。</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'circle'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token number">2.71828182846</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">exp</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="跨模块常量"><a href="#跨模块常量" aria-hidden="true" class="header-anchor">#</a> 跨模块常量</h4> <ul><li>const声明的常量只在当前代码块有效。</li> <li>如果想设置跨模块的常量（即跨多个文件），或者说一个值要被多个模块共享
<ul><li>建一个专门的constants目录</li> <li>将这些文件输出的常量，合并在index.js里面。</li> <li>使用的时候，直接加载index.js</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// constants/db.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">'http://my.couchdbserver.local:5984'</span><span class="token punctuation">,</span>
  admin_username<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
  admin_password<span class="token punctuation">:</span> <span class="token string">'admin password'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// constants/user.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'root'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'staff'</span><span class="token punctuation">,</span> <span class="token string">'ceo'</span><span class="token punctuation">,</span> <span class="token string">'chief'</span><span class="token punctuation">,</span> <span class="token string">'moderator'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// constants/index.js</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>db<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./db'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>users<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users'</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// script.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>db<span class="token punctuation">,</span> users<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants/index'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="import"><a href="#import" aria-hidden="true" class="header-anchor">#</a> import()</h3> <ul><li>require是运行时加载模块，import命令无法取代require的动态加载功能。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// require到底加载哪一个模块，只有运行时才知道。</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token string">'./'</span> <span class="token operator">+</span> fileName<span class="token punctuation">;</span>
<span class="token keyword">const</span> myModual <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>提案，建议引入import()函数，完成动态加载。
<ul><li>返回一个 Promise 对象。</li> <li>import()类似于 Node 的require方法，区别主要是前者是异步加载，后者是同步加载。</li></ul></li> <li>适用场合
<ul><li>按需加载。</li> <li>条件加载</li> <li>动态的模块路径</li></ul></li></ul> <h2 id="module的加载实现"><a href="#module的加载实现" aria-hidden="true" class="header-anchor">#</a> Module的加载实现</h2> <h3 id="浏览器加载"><a href="#浏览器加载" aria-hidden="true" class="header-anchor">#</a> 浏览器加载</h3> <ul><li><p>传统方法</p> <ul><li><code>&lt;script&gt;</code>标签打开<code>defer</code>或<code>async</code>属性，脚本就会异步加载。(渲染引擎遇到这一行命令，就会开始下载外部脚本，但不会等它下载和执行，而是直接执行后面的命令。)</li></ul> <div class="warning custom-block"><p class="custom-block-title">defer和async区别</p> <p>defer是“渲染完再执行”，能保证加载顺序，async是“下载完就执行”，无法保证加载顺序。</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;path/to/myModule.js&quot;</span> async<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>ES6模块加载规则</p> <ul><li><p>使用<code>&lt;script&gt;</code>标签，加入<code>type=&quot;module&quot;</code>属性</p> <ul><li>对于<code>type=&quot;module&quot;</code>的默认（defer）异步加载</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./foo.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>内嵌脚本</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span><span class="token operator">&gt;</span>
  <span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">&quot;./utils.js&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// other code</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h3 id="es6-模块与-commonjs-模块的差异"><a href="#es6-模块与-commonjs-模块的差异" aria-hidden="true" class="header-anchor">#</a> ES6 模块与 CommonJS 模块的差异</h3> <ul><li>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是值的引用。</li> <li>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口。</li></ul> <h3 id="node加载"><a href="#node加载" aria-hidden="true" class="header-anchor">#</a> Node加载</h3> <ul><li><p>概述</p> <ul><li>Node 与 ES6 模块格式是不兼容的。</li> <li>要求 ES6 模块采用.mjs后缀文件名。(require命令不能加载.mjs文件,.mjs文件里面也不能使用require命令)</li></ul></li> <li><p>内部变量</p> <ul><li>ES6 模块之中不能使用 CommonJS 模块的特有的一些内部变量。
<ul><li>this关键字。
<ul><li>ES6 模块之中，顶层的this指向undefined；CommonJS 模块的顶层this指向当前模块，</li></ul></li> <li>arguments</li> <li>require</li> <li>module</li> <li>exports</li> <li>__filename</li> <li>__dirname</li></ul></li></ul></li> <li><p>ES6 模块加载 CommonJS 模块</p> <ul><li>Node 的import命令加载 CommonJS 模块，会自动将module.exports属性，当作export default xxx。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// a.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
  bar<span class="token punctuation">:</span> <span class="token string">'world'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
  bar<span class="token punctuation">:</span> <span class="token string">'world'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>CommonJS 模块加载 ES6 模块</p> <ul><li>使用import()函数,ES6 模块的所有输出接口，会成为输入对象的属性。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// es.mjs</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span> bar<span class="token punctuation">:</span> <span class="token string">'my-default'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> foo<span class="token punctuation">;</span>
<span class="token comment">// cjs.js</span>
<span class="token keyword">const</span> es_namespace <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./es.mjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// es_namespace = {</span>
<span class="token comment">//   get default() {</span>
<span class="token comment">//     ...</span>
<span class="token comment">//   }</span>
<span class="token comment">// }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>es_namespace<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { bar:'my-default' }</span>
</code></pre></div></li> <li><p>循环加载</p> <ul><li>a脚本的执行依赖b脚本，而b脚本的执行又依赖a脚本。</li> <li>CommonJS 模块一旦出现某个模块被&quot;循环加载&quot;，就只输出已经执行的部分，还未执行的部分不会输出。</li> <li>需要开发者自己保证，真正取值的时候能够取到值。需要开发者自己保证，真正取值的时候能够取到值。</li></ul></li></ul> <h3 id="es6-模块的转码"><a href="#es6-模块的转码" aria-hidden="true" class="header-anchor">#</a> ES6 模块的转码</h3> <ul><li>浏览器目前还不支持 ES6 模块，为了现在就能使用，可以将其转为 ES5 的写法。</li></ul> <h4 id="转码方法"><a href="#转码方法" aria-hidden="true" class="header-anchor">#</a> 转码方法</h4> <ul><li>Babel</li> <li>ES6 module transpiler</li> <li>SystemJS</li></ul> <h3 id="编程风格"><a href="#编程风格" aria-hidden="true" class="header-anchor">#</a> 编程风格</h3> <h4 id="块级作用域-2"><a href="#块级作用域-2" aria-hidden="true" class="header-anchor">#</a> 块级作用域</h4> <ul><li>let取代var</li> <li>在let和const之间，建议优先使用const，尤其是在全局环境，不应该设置变量，只应设置常量。</li> <li>所有的函数都应该设置为常量。</li></ul> <h4 id="字符串"><a href="#字符串" aria-hidden="true" class="header-anchor">#</a> 字符串</h4> <ul><li>静态字符串一律使用单引号或反引号，不使用双引号。</li> <li>动态字符串使用反引号。</li></ul> <h4 id="解构赋值-2"><a href="#解构赋值-2" aria-hidden="true" class="header-anchor">#</a> 解构赋值</h4> <ul><li>使用数组成员对变量赋值时，优先使用解构赋值。</li> <li>函数的参数如果是对象的成员，优先使用解构赋值。</li> <li>如果函数返回多个值，优先使用对象的解构赋值，而不是数组的解构赋值。这样便于以后添加返回值，以及更改返回值的顺序。</li></ul> <h4 id="对象"><a href="#对象" aria-hidden="true" class="header-anchor">#</a> 对象</h4> <ul><li>单行定义的对象，最后一个成员不以逗号结尾。多行定义的对象，最后一个成员以逗号结尾。</li> <li>对象尽量静态化，一旦定义，就不得随意添加新的属性。如果添加属性不可避免，要使用Object.assign方法。</li> <li>如果对象的属性名是动态的，可以在创造对象的时候，使用属性表达式定义。</li> <li>对象的属性和方法，尽量采用简洁表达法</li></ul> <h4 id="数组"><a href="#数组" aria-hidden="true" class="header-anchor">#</a> 数组</h4> <ul><li>使用扩展运算符（...）拷贝数组。</li> <li>使用 Array.from 方法，将类似数组的对象转为数组。</li></ul> <h4 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h4> <ul><li>立即执行函数可以写成箭头函数的形式。</li> <li>那些使用匿名函数当作参数的场合，尽量用箭头函数代替。因为这样更简洁，而且绑定了 this。</li> <li>箭头函数取代Function.prototype.bind，不应再用 self/_this/that 绑定 this。</li> <li>简单的、单行的、不会复用的函数，建议采用箭头函数。如果函数体较为复杂，行数较多，还是应该采用传统的函数写法。</li> <li>所有配置项都应该集中在一个对象，放在最后一个参数，布尔值不可以直接作为参数。</li> <li>不要在函数体内使用 arguments 变量，使用 rest 运算符（...）代替。</li> <li>使用默认值语法设置函数参数的默认值。</li></ul> <h4 id="map结构"><a href="#map结构" aria-hidden="true" class="header-anchor">#</a> Map结构</h4> <ul><li>区分 Object 和 Map，只有模拟现实世界的实体对象时，才使用 Object。如果只是需要key: value的数据结构，使用 Map 结构。因为 Map 有内建的遍历机制。</li></ul> <h4 id="class"><a href="#class" aria-hidden="true" class="header-anchor">#</a> Class</h4> <ul><li>用 Class，取代需要 prototype 的操作</li> <li>使用extends实现继承</li></ul> <h4 id="模块"><a href="#模块" aria-hidden="true" class="header-anchor">#</a> 模块</h4> <ul><li>Module 语法是 JavaScript 模块的标准写法，使用import取代require。</li> <li>使用export取代module.exports。</li> <li>export default与普通的export不要同时使用。</li> <li>不要在模块输入中使用通配符。因为这样可以确保你的模块之中，有一个默认输出（export default）。</li> <li>如果模块默认输出一个函数，函数名的首字母应该小写。</li> <li>如果模块默认输出一个对象，对象名的首字母应该大写。</li></ul> <h4 id="eslint-的使用"><a href="#eslint-的使用" aria-hidden="true" class="header-anchor">#</a> ESLint 的使用</h4> <ul><li>安装</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$ npm i <span class="token operator">-</span>g eslint
</code></pre></div><ul><li>安装 Airbnb 语法规则，以及 import、a11y、react 插件。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$ npm i <span class="token operator">-</span>g eslint<span class="token operator">-</span>config<span class="token operator">-</span>airbnb
$ npm i <span class="token operator">-</span>g eslint<span class="token operator">-</span>plugin<span class="token operator">-</span><span class="token keyword">import</span> eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>jsx<span class="token operator">-</span>a11y eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>react
</code></pre></div><ul><li>根目录下新建一个.eslintrc文件，配置 ESLint。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;extends&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;eslint-config-airbnb&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>即可使用以上规则检查文件</li></ul> <h3 id="异步遍历器"><a href="#异步遍历器" aria-hidden="true" class="header-anchor">#</a> 异步遍历器</h3> <h3 id="arraybuffer"><a href="#arraybuffer" aria-hidden="true" class="header-anchor">#</a> ArrayBuffer</h3> <ul><li>是 JavaScript 操作二进制数据的一个接口。</li></ul> <h3 id="最新提案"><a href="#最新提案" aria-hidden="true" class="header-anchor">#</a> 最新提案</h3> <h3 id="修饰器"><a href="#修饰器" aria-hidden="true" class="header-anchor">#</a> 修饰器</h3> <ul><li>Decorator 提案经过了大幅修改，目前还没有定案</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>@testable
<span class="token keyword">class</span> <span class="token class-name">MyTestableClass</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">testable</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>isTestable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
MyTestableClass<span class="token punctuation">.</span>isTestable <span class="token comment">// true</span>
</code></pre></div><h3 id="es5中的类"><a href="#es5中的类" aria-hidden="true" class="header-anchor">#</a> es5中的类</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token operator">=</span>type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'eat'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 继承的三种方法</span>
<span class="token comment">// 1.继承实例上的属性</span>
<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2.获取父类的公共属性</span>
<span class="token operator">-</span> node刚出来的时候
es5<span class="token punctuation">:</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__<span class="token operator">=</span><span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token operator">-</span> node6<span class="token punctuation">.</span><span class="token number">0</span>的时候
es5<span class="token punctuation">:</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token punctuation">{</span>constructor<span class="token punctuation">:</span><span class="token punctuation">{</span>value<span class="token punctuation">:</span>Cat<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span> es6出来以后
es6<span class="token punctuation">:</span>Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span><span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cat<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'哺乳类'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span>eat<span class="token punctuation">)</span>
<span class="token comment">// 3.继承父类实例上的所有属性：因为初始化子类不能给父类传参，所以没人用，一般用1+2</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cat<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'哺乳类'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="用es5实现es6class类"><a href="#用es5实现es6class类" aria-hidden="true" class="header-anchor">#</a> 用es5实现es6Class类</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token parameter">sub<span class="token punctuation">,</span>constr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>sub <span class="token keyword">instanceof</span> <span class="token class-name">constr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Cannot with new '</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">Animal</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>Animal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断如果不是通过new返回错误</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token operator">=</span>type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_createClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用Object.defineProperty，因为通过es6类创建的方法是不可看到的</span>
  <span class="token keyword">return</span> Animal<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//...没看懂==！</span>
</code></pre></div><h2 id="装饰器"><a href="#装饰器" aria-hidden="true" class="header-anchor">#</a> 装饰器</h2> <ul><li>@符号表示是装饰器</li> <li>可以修饰类，类中的属性和方法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sweetCoffee</span><span class="token punctuation">(</span><span class="token parameter">coffee</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'加糖'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">coffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'一杯苦coffee'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">sweetCoffee</span><span class="token punctuation">(</span>coffee<span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>@testable
<span class="token keyword">class</span> <span class="token class-name">MyTestableClass</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">testable</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  target<span class="token punctuation">.</span>isTestable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
MyTestableClass<span class="token punctuation">.</span>isTestable <span class="token comment">// true</span>
</code></pre></div><h2 id="其他语法"><a href="#其他语法" aria-hidden="true" class="header-anchor">#</a> 其他语法</h2> <ul><li>Object.is(value1, value2);
<ul><li>参数
<ul><li>value1，第一个需要比较的值。</li> <li>value2，第二个需要比较的值。</li></ul></li> <li>返回值
<ul><li>表示两个参数是否相同的<code>布尔值</code> 。</li></ul></li></ul></li> <li>是不是非数
<ul><li>window.isNaN()
<ul><li>先把参数转化为数字类型,再判断是不是 NaN</li> <li>只要不是数字都满足</li></ul></li> <li>Number.isNaN()
<ul><li>先判断参数是不是数字类型,不是就返回 false, 是数字类型再进入判断是不是 NaN.</li> <li>只有数字中的NaN满足</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span>
Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span>
</code></pre></div><h2 id="第三方模块"><a href="#第三方模块" aria-hidden="true" class="header-anchor">#</a> 第三方模块</h2> <h3 id="babel"><a href="#babel" aria-hidden="true" class="header-anchor">#</a> babel</h3> <ul><li>转换es6成es5</li> <li>可在命令行中直接转换</li></ul> <ol><li>安装babel</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>cli @babel<span class="token operator">/</span>core<span class="token comment">//babel核心和babelcli</span>
npm add @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env<span class="token comment">//babel插件1</span>
npm add @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>properties<span class="token comment">//babel插件2</span>
npm add @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span>decorators<span class="token comment">//babel插件3</span>
</code></pre></div><ol start="2"><li>新建一个.babelrc文件，运行时会按这个文件的方式来解析</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token comment">//这个插件告诉babel按es6到es5编译</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span><span class="token comment">//这个插件用来转化类上的属性</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;loose&quot;</span><span class="token punctuation">:</span><span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/plugin-proposal-decorators&quot;</span><span class="token punctuation">,</span><span class="token comment">//这个插件用来识别类装饰器</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;legacy&quot;</span><span class="token punctuation">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>解析</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Circle</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token operator">=</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token comment">//简写成如下写法</span>
  a<span class="token operator">=</span><span class="token number">1</span><span class="token comment">//高级写法，可用babel解析识别</span>
  <span class="token keyword">static</span> <span class="token constant">PI</span><span class="token operator">=</span><span class="token number">3.14</span><span class="token comment">//es6不支持静态属性，可用babel解析识别</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> c<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
命令：babel <span class="token number">6.</span>class<span class="token punctuation">.</span>js <span class="token operator">-</span>o <span class="token keyword">new</span><span class="token punctuation">.</span>jss
</code></pre></div><h3 id="moment"><a href="#moment" aria-hidden="true" class="header-anchor">#</a> moment</h3> <ul><li>时间的插件(12345676543245 YYYY-MM-DD)
<ul><li>可以算相对时间 多语言</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>yarn add moment
<span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-cn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">moment</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取'YYYY-MM-DD HH:mm:ss'格式的时间</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Frontend/js/runenv/" class="prev">
          04-运行环境
        </a></span> <span class="next"><a href="/Frontend/js/designpatterns/">
          前端设计模式
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.6687386d.js" defer></script><script src="/assets/js/19.742b6037.js" defer></script>
  </body>
</html>
