<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4311df0.css" as="style"><link rel="preload" href="/assets/js/app.c4cf2eda.js" as="script"><link rel="preload" href="/assets/js/15.6aeae412.js" as="script"><link rel="prefetch" href="/assets/js/10.6cd71b79.js"><link rel="prefetch" href="/assets/js/11.422b6fcc.js"><link rel="prefetch" href="/assets/js/12.98e6e0fd.js"><link rel="prefetch" href="/assets/js/13.50517f5f.js"><link rel="prefetch" href="/assets/js/14.706f6f8f.js"><link rel="prefetch" href="/assets/js/16.6f9f8d7c.js"><link rel="prefetch" href="/assets/js/17.4a939374.js"><link rel="prefetch" href="/assets/js/18.8ca9d15a.js"><link rel="prefetch" href="/assets/js/19.0379ebaf.js"><link rel="prefetch" href="/assets/js/2.e27297f7.js"><link rel="prefetch" href="/assets/js/20.628ecc9a.js"><link rel="prefetch" href="/assets/js/21.00910530.js"><link rel="prefetch" href="/assets/js/22.2b1e5011.js"><link rel="prefetch" href="/assets/js/23.8097ecb2.js"><link rel="prefetch" href="/assets/js/24.f22c2e26.js"><link rel="prefetch" href="/assets/js/25.7f3808a6.js"><link rel="prefetch" href="/assets/js/26.99a7eac6.js"><link rel="prefetch" href="/assets/js/27.a13d7bf0.js"><link rel="prefetch" href="/assets/js/3.3d37efe5.js"><link rel="prefetch" href="/assets/js/4.2b055829.js"><link rel="prefetch" href="/assets/js/5.a49d4744.js"><link rel="prefetch" href="/assets/js/6.fbe1d0e6.js"><link rel="prefetch" href="/assets/js/7.b5e36c76.js"><link rel="prefetch" href="/assets/js/8.9a129d08.js"><link rel="prefetch" href="/assets/js/9.c45149f5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4311df0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qianduan/" class="nav-link">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">内功</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/qianduan/" class="nav-link">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link router-link-active">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">内功</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>后端基础汇总</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/houduan/node.html" class="active sidebar-link">node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/houduan/node.html#fs-有sync是同步-无是异步" class="sidebar-link">fs(有Sync是同步  无是异步)</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#path" class="sidebar-link">path</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#process" class="sidebar-link">process</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#url" class="sidebar-link">url</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#vm" class="sidebar-link">vm</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#buffer" class="sidebar-link">buffer</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#events" class="sidebar-link">events</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#util" class="sidebar-link">util</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#stream" class="sidebar-link">stream</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#http" class="sidebar-link">http</a></li><li class="sidebar-sub-header"><a href="/houduan/node.html#常用的库" class="sidebar-link">常用的库</a></li></ul></li><li><a href="/houduan/ios.html" class="sidebar-link">ISO</a></li><li><a href="/houduan/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/houduan/egg.html" class="sidebar-link">egg</a></li><li><a href="/houduan/mock.html" class="sidebar-link">Mockjs</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="node"><a href="#node" aria-hidden="true" class="header-anchor">#</a> node</h1> <h2 id="fs-有sync是同步-无是异步"><a href="#fs-有sync是同步-无是异步" aria-hidden="true" class="header-anchor">#</a> fs(有Sync是同步  无是异步)</h2> <p><strong>1、fs.access('文件名字') 判断文件是否存在</strong></p> <p><strong>2、fs.readdir('m') 读取根文件下的 m文件下面的文件 返回一个数组 没有则是空数组</strong></p> <p><strong>3、let r = fs.stat('m') 读取根文件下的 m文件的状态</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  r<span class="token punctuation">.</span>size 文件的大小
  r<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 判断文件是不是目录
  r<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 判断文件是不是文件
</code></pre></div><p><strong>4、fs.rmdir('m') 删除m目录fs.unlink('m') 删除m文件</strong></p> <p><strong>5、fs.open('text.js','r',(err,fdr)=&gt;{}) 打开文件</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token comment">//'r' 做什么  flag:'r'/'w'			</span>
      <span class="token comment">//回调  fdr 打开文件的标示 是一个数字</span>
    fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bufLength<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>bytesRead<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//fdr 			打开文件 的一个标示</span>
      <span class="token comment">//buf 			临时存储的一个流空间</span>
      <span class="token comment">//0   			读取buf的开始位子</span>
      <span class="token comment">//bufLength 读取buf的长度</span>
      <span class="token comment">//null      文件开始读取的位子</span>
      <span class="token comment">//回调      bytesRead参数是 实际读取的字节数</span>
    fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bufLength<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//参数同上</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fdr<span class="token punctuation">)</span>
</code></pre></div><h2 id="path"><a href="#path" aria-hidden="true" class="header-anchor">#</a> path</h2> <p><strong>1、__dirname表示的是当前的文件所在的文件夹</strong></p> <p><strong>2、path.resolve(__dirname,'test.js')   这两个都一样 用来拼接地址</strong></p> <p><strong>3、path.join(__dirname ,'test.js')</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  path<span class="token punctuation">.</span>resolve和path<span class="token punctuation">.</span><span class="token function">join区别</span><span class="token punctuation">(</span>第二个参数是否带<span class="token operator">/</span><span class="token punctuation">)</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token comment">//e:\index.html</span>
  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token comment">//e:\study\node\index.html</span>
</code></pre></div><p><strong>4、path.extname(1123.js)               输出.js(找后缀)</strong></p> <p><strong>5、path.basename('1.min.js','.js')     输出1.min(通过后缀 找文件路径)</strong></p> <h2 id="process"><a href="#process" aria-hidden="true" class="header-anchor">#</a> process</h2> <p><strong>1、process.pid       node进程</strong></p> <p><strong>2、process.exit()    停止当前进程(node中断)</strong></p> <p><strong>3、process.cwd()     查找当前绝对定位的目录(vscode当前打开的文件夹和git当前文件)</strong></p> <p><strong>4、process.chdir()   改变工作目录</strong></p> <p><strong>5、process.nextTick  异步跟promise差不多(里面不能递归)</strong></p> <p><strong>6、process.env.NODE_ENV  暂时不会</strong></p> <p><strong>7、process.argv      暂时不会</strong></p> <p><strong>8、process.stdin标准输入 是一个可读流  在控制台上操作</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token comment">//在控制台输入123</span>
   <span class="token comment">// 0d 0a  代表换行 回撤</span>
</code></pre></div><p><strong>9、process.stdout标准输出 是一个可写  将内容输出到控制台</strong></p> <h2 id="url"><a href="#url" aria-hidden="true" class="header-anchor">#</a> url</h2> <p><strong>url 模块下的parse(url,boolean) 能解析 url  boolean为true时 取到的query是一个对象(?后面的)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token punctuation">{</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">}</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com:8080/s?a==1'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">)</span> <span class="token comment">// /s { a: '=1' }</span>
</code></pre></div><h2 id="vm"><a href="#vm" aria-hidden="true" class="header-anchor">#</a> vm</h2> <p><strong>vm.runInThisContext(fn)  沙箱 fn放在一个独立的虚拟环境中(在require源码会用到)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token template-string"><span class="token string">`(function a(){let b = 1;console.log('b2',b)})()`</span></span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
</code></pre></div><h2 id="buffer"><a href="#buffer" aria-hidden="true" class="header-anchor">#</a> buffer</h2> <ul><li>声明</li></ul> <p><strong>1、Buffer.alloc('12') 通过数组声明</strong></p> <p><strong>2、Buffer.from('我')  通过存放数组或者字符</strong></p> <ul><li>方法 (跟数组类似,没有分割split)</li></ul> <p><strong>1、slice(是同组数都是浅拷贝 拷贝的是引用地址)</strong></p> <p><strong>2、forEach</strong></p> <p><strong>3、copy</strong></p> <p><strong>4、concat(同数组)</strong></p> <p><strong>5、indexOf(同数组)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">//concat用法</span>
    <span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span>a2<span class="token punctuation">,</span>a3<span class="token punctuation">]</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
      <span class="token function">例子</span><span class="token punctuation">(</span>a1等代表的是Buffer<span class="token punctuation">,</span>n代表的是截取多少字节<span class="token punctuation">,</span>不写就是全部<span class="token punctuation">)</span>
      <span class="token keyword">let</span> a1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'我'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> a2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ni'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> r <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span>a2<span class="token punctuation">]</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
  <span class="token comment">//重写split方法</span>
  <span class="token class-name">Buffer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">split</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span>length
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!=</span> index<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span>index<span class="token punctuation">)</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      offset <span class="token operator">=</span> len <span class="token operator">+</span> index
      index <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>offset<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="events"><a href="#events" aria-hidden="true" class="header-anchor">#</a> events</h2> <p><strong>1、on('事件','函数')				监听</strong></p> <p><strong>2、on('newListener','函数')    	监听 用户绑定的事件</strong></p> <p><strong>3、once('事件','函数')    			监听一次</strong></p> <p><strong>4、emit('事件')    				发布</strong></p> <p><strong>5、prependListener('事件','函数')   插队到最前面</strong></p> <p><strong>6、off('事件','函数')           	 删除</strong></p> <p><strong>7、defaultMaxListeners      		事件总数</strong></p> <h2 id="util"><a href="#util" aria-hidden="true" class="header-anchor">#</a> util</h2> <p><strong>1、util.inherits(girl类,people类) girl继承people原型上的方法</strong></p> <p><strong>继承原型上的属性 公有属性(私有的不会继承)</strong></p> <p><strong>2、n.call(obj,参数1) fn是方法 obj是对象(继承私有的)</strong></p> <p><strong>3、stat = util.promisify(fs.stat) 将fs.stat方法包装成 promise 只能一个个添加 对应的还有一个mz</strong></p> <p><strong>4、let fs = require('mz/fs') mz需要引入 mz将fs所有的方法转换成promise</strong></p> <h2 id="stream"><a href="#stream" aria-hidden="true" class="header-anchor">#</a> stream</h2> <p><strong>流:</strong> 并不关系整体文件大小</p> <p><strong>分类:</strong> 可读、可写、转换、双工流</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">//读流</span>
  <span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.md'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>
    <span class="token function">options</span><span class="token punctuation">(</span>对象<span class="token punctuation">)</span>
      flags<span class="token punctuation">:</span><span class="token string">'r'</span><span class="token punctuation">,</span>
      encoding<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
      autoClose<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      start<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
      end<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 包前又包后</span>
      highWaterMark<span class="token punctuation">:</span><span class="token number">3</span> <span class="token comment">//默认64K 每次读取64k</span>
      <span class="token comment">//默认情况下 非流动模式 如果监听了on('data')事件 就变成流动模式 </span>
      <span class="token comment">//不停的读取文件 将文件读取完毕(最快的速度),之后触发on('end')事件</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'resume'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pause'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//写流</span>
  <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>
      <span class="token function">options</span><span class="token punctuation">(</span>对象<span class="token punctuation">)</span>
        flags<span class="token punctuation">:</span> <span class="token string">'w'</span><span class="token punctuation">,</span>
        encoding<span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
        autoClose<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        highWaterMark<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">//默认16K 不是代表的每次能写16k  预计我用16k来写</span>
      ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drain'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//drain 只有当我们写入的内容大于我们的预期，并且被清空后才会触发事件</span>
  <span class="token comment">//pipe 边读边写</span>
  <span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    highWaterMark<span class="token punctuation">:</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'2.txt'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    highWaterMark<span class="token punctuation">:</span><span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//边读边写</span>
  rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
</code></pre></div><h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> http</h2> <p>http版本1.1</p> <p><strong>长连接</strong>
每次请求的时候不会重新创建新的通道,会复用原来的通道</p> <p><strong>管线化</strong>
数据并发(多个请求)
<strong>url和uri</strong></p> <ul><li>URI:统一资源标识符</li> <li>URL:统一资源定位符</li> <li>URN:统一资源命名符</li></ul> <p><strong>URL的格式</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>user<span class="token punctuation">:</span>pass@www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>jp<span class="token punctuation">:</span><span class="token number">80</span><span class="token operator">/</span>dir<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">?</span>uid<span class="token operator">=</span><span class="token number">1</span>#ch1
    http            协议方案名
    user<span class="token punctuation">:</span>pass       <span class="token function">登陆信息</span><span class="token punctuation">(</span>认证<span class="token punctuation">)</span>
    www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>jp  服务器地址
    <span class="token number">80</span>              端口
    dir<span class="token operator">/</span>index<span class="token punctuation">.</span>html  带层次的文件路径
    uid             查询字符串
    ch1             <span class="token function">片段标识符</span><span class="token punctuation">(</span>后端拿不到这个值<span class="token punctuation">)</span>    
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>  常用状态码<span class="token punctuation">:</span>
    <span class="token number">1</span><span class="token function">XX</span><span class="token punctuation">(</span>信息状态码 websocket才用<span class="token punctuation">)</span>
    <span class="token number">2</span><span class="token function">XX</span><span class="token punctuation">(</span>Success 成功状态码<span class="token punctuation">)</span>
      <span class="token number">200</span><span class="token punctuation">:</span>正常返回
      <span class="token number">204</span><span class="token punctuation">:</span>返回的结果只有请求头 没有响应体
      <span class="token number">206</span><span class="token punctuation">:</span>分段传输
    <span class="token number">3</span><span class="token function">XX</span><span class="token punctuation">(</span>Redirection 重定向<span class="token punctuation">)</span>
      <span class="token number">301</span><span class="token punctuation">:</span>永久重定向
      <span class="token number">302</span><span class="token punctuation">:</span>临时重定向
      <span class="token number">304</span><span class="token punctuation">:</span>缓存
    <span class="token number">4</span><span class="token function">XX</span><span class="token punctuation">(</span>Client Error 客户端错误状态码<span class="token punctuation">)</span>
      <span class="token number">401</span><span class="token punctuation">:</span>没有权限
      <span class="token number">403</span><span class="token punctuation">:</span>登陆了 还是没有权限
      <span class="token number">404</span><span class="token punctuation">:</span>找不到资源
    <span class="token number">5</span><span class="token function">XX</span><span class="token punctuation">(</span>Server Error 服务器错误状态码<span class="token punctuation">)</span>
      <span class="token number">500</span><span class="token punctuation">:</span>服务器挂了
      <span class="token number">503</span><span class="token punctuation">:</span>负载均衡超标
</code></pre></div><p>请求(一对)</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>get / post / put / delete / options(预发射/试探性,在跨域的时候用到) / head</p> <p>资源url (/form/entry/)</p> <p>协议版本(HTTP/1.1)</p> <p>Host: hacker.jp  请求头</p> <p>Connection: keep-alive</p> <p>Connection-Type:application/x-www-form-urlencoded</p> <p>Content-Length:16</p></div> <p><strong>模拟最简陋的client</strong></p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// node中核心模块 http模块 专门用来创建http服务的</span>
<span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// http.get 他只能发送get请求（没有请求体）</span>
<span class="token comment">// post localhost:3000/path</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token punctuation">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span><span class="token string">'/user?a=1&amp;b=2#hash'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">'seven'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 请求体</span>
client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'age=9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>搭建最简陋的server</strong></p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//req 相当于是可以端的请求 可读流</span>
<span class="token comment">//res 是代表稍后我要写响应 可写流</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求的方法就是大写的</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//POST</span>
  <span class="token comment">// 从/后面到#前面的部分(浏览器环境) </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// /user?a=1&amp;b=2</span>
  <span class="token comment">// 请求头都是小写的 content-type</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象</span>

  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果有请求体会触发on('data')事件，如果没有请求体会触发on('end')事件，不管有没有请求体 end事件都会触发</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求替'</span><span class="token punctuation">)</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//接收的数据</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 表示结束了</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">,</span><span class="token string">'localhost'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3000端口启动了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="常用的库"><a href="#常用的库" aria-hidden="true" class="header-anchor">#</a> 常用的库</h2> <p><strong>1、let mime = require('mime')</strong></p> <p><strong>2、let fs = require('mz/fs')</strong></p> <p>mz需要引入 mz将fs所有的方法转换成promise</p> <p><strong>3、require('querystring').parse(str,'&amp;@','#=')</strong></p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>后面两个参数默认是 <span class="token string">'&amp;'</span> <span class="token string">'='</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'username#=123&amp;@password#=456'</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token string">'&amp;@'</span><span class="token punctuation">,</span><span class="token string">'#='</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token comment">//{ username: '123', password: '456' }</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/houduan/ios.html">
          ISO
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c4cf2eda.js" defer></script><script src="/assets/js/15.6aeae412.js" defer></script>
  </body>
</html>
