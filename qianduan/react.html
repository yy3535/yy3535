<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react 汇总 | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.d4311df0.css" as="style"><link rel="preload" href="/assets/js/app.c4cf2eda.js" as="script"><link rel="preload" href="/assets/js/24.f22c2e26.js" as="script"><link rel="prefetch" href="/assets/js/10.6cd71b79.js"><link rel="prefetch" href="/assets/js/11.422b6fcc.js"><link rel="prefetch" href="/assets/js/12.98e6e0fd.js"><link rel="prefetch" href="/assets/js/13.50517f5f.js"><link rel="prefetch" href="/assets/js/14.706f6f8f.js"><link rel="prefetch" href="/assets/js/15.6aeae412.js"><link rel="prefetch" href="/assets/js/16.6f9f8d7c.js"><link rel="prefetch" href="/assets/js/17.4a939374.js"><link rel="prefetch" href="/assets/js/18.8ca9d15a.js"><link rel="prefetch" href="/assets/js/19.0379ebaf.js"><link rel="prefetch" href="/assets/js/2.e27297f7.js"><link rel="prefetch" href="/assets/js/20.628ecc9a.js"><link rel="prefetch" href="/assets/js/21.00910530.js"><link rel="prefetch" href="/assets/js/22.2b1e5011.js"><link rel="prefetch" href="/assets/js/23.8097ecb2.js"><link rel="prefetch" href="/assets/js/25.7f3808a6.js"><link rel="prefetch" href="/assets/js/26.99a7eac6.js"><link rel="prefetch" href="/assets/js/27.a13d7bf0.js"><link rel="prefetch" href="/assets/js/3.3d37efe5.js"><link rel="prefetch" href="/assets/js/4.2b055829.js"><link rel="prefetch" href="/assets/js/5.a49d4744.js"><link rel="prefetch" href="/assets/js/6.fbe1d0e6.js"><link rel="prefetch" href="/assets/js/7.b5e36c76.js"><link rel="prefetch" href="/assets/js/8.9a129d08.js"><link rel="prefetch" href="/assets/js/9.c45149f5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d4311df0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qianduan/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">内功</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/qianduan/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">运维</a></div><div class="nav-item"><a href="/foundation/" class="nav-link">内功</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>前端基础汇总</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/qianduan/js.html" class="sidebar-link">js</a></li><li><a href="/qianduan/react.html" class="active sidebar-link">react 汇总</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/qianduan/react.html#基础用法" class="sidebar-link">基础用法</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#proptypes验证" class="sidebar-link">PropTypes验证</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#setstate-异步渲染问题" class="sidebar-link">setState 异步渲染问题</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#render-component-children区别" class="sidebar-link">render component children区别</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#react-redux用法" class="sidebar-link">react-redux用法</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#couter-todolist-例子" class="sidebar-link">couter&amp;&amp;todoList 例子</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#redux核心" class="sidebar-link">redux核心</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#redux-saga-原理" class="sidebar-link">redux-saga 原理</a></li><li class="sidebar-sub-header"><a href="/qianduan/react.html#dva用法" class="sidebar-link">dva用法</a></li></ul></li><li><a href="/qianduan/vue.html" class="sidebar-link">vue 汇总</a></li><li><a href="/qianduan/vuepress.html" class="sidebar-link">vuepress</a></li><li><a href="/qianduan/phone.html" class="sidebar-link">移动端</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="react-汇总"><a href="#react-汇总" aria-hidden="true" class="header-anchor">#</a> react 汇总</h1> <p></p><div class="table-of-contents"><ul><li><a href="#基础用法">基础用法</a></li><li><a href="#生命周期">生命周期</a></li><li><a href="#proptypes验证">PropTypes验证</a></li><li><a href="#setstate-异步渲染问题">setState 异步渲染问题</a></li><li><a href="#路由">路由</a></li><li><a href="#render-component-children区别">render component children区别</a></li><li><a href="#react-redux用法">react-redux用法</a></li><li><a href="#couter-todolist-例子">couter&amp;&amp;todoList 例子</a></li><li><a href="#redux核心">redux核心</a></li><li><a href="#redux-saga-原理">redux-saga 原理</a></li><li><a href="#dva用法">dva用法</a></li></ul></div><p></p> <ul><li>安装
<ul><li>cnpm install create-react-app -g 脚手架</li> <li>create-react-app reactdom  初始化项目</li></ul></li></ul> <h2 id="基础用法"><a href="#基础用法" aria-hidden="true" class="header-anchor">#</a> 基础用法</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1</span>、<span class="token operator">&lt;</span>Parent<span class="token operator">&gt;</span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span>Parent<span class="token operator">&gt;</span>
子组件 通过<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children 获取xxx

<span class="token number">2</span>、<span class="token operator">&lt;</span>Parent number<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>xxx<span class="token operator">&lt;</span><span class="token operator">/</span>Parent<span class="token operator">&gt;</span>
加<span class="token punctuation">{</span><span class="token punctuation">}</span>传递的就是数值

<span class="token number">3</span>、<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>num<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> 组件传值
<span class="token operator">&lt;</span>Parent <span class="token punctuation">{</span><span class="token operator">...</span>obj<span class="token punctuation">}</span> n<span class="token operator">=</span><span class="token string">'2'</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Parent<span class="token operator">&gt;</span>

<span class="token number">4</span>、<span class="token operator">&lt;</span>Counter<span class="token operator">&gt;</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">123</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Counter<span class="token operator">&gt;</span>
    <span class="token parameter">获取组件里面的子元素</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children
    渲染 一般不用map 因为 里面可能有一个 可能都有多个最终得到的结构都不一样
    官方有个方法 React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span>map 第一个参数是<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children 第二个是要渲染的内容
    <span class="token punctuation">{</span>React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>     
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token number">5</span>、
  <span class="token number">1</span>、父传子 靠属性
  <span class="token number">2</span>、平级   靠公共的父组件
  <span class="token number">3</span><span class="token function">、跨级</span><span class="token punctuation">(</span>祖孙<span class="token punctuation">)</span> 靠Context api   祖传子<span class="token operator">-</span>直接传   子传祖<span class="token operator">-</span>用回调

<span class="token number">6</span>、Context api用法
    创建一个文件
    <span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">,</span>Consumer<span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">export</span><span class="token punctuation">{</span>Provider<span class="token punctuation">,</span>Consumer<span class="token punctuation">}</span>

    父级提供 value是固定的
        <span class="token operator">&lt;</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>r<span class="token punctuation">:</span>传递的内容<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span> 父级组件 <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
    子级
        <span class="token operator">&lt;</span>Consumer<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>r<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>按键
                    <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Consumer<span class="token operator">&gt;</span>

<span class="token number">7</span>、ref
    声明
    input <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    绑定
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">'text'</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    获取
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">)</span>

<span class="token number">8</span>、函数里面的别名
  <span class="token keyword">let</span> a  <span class="token operator">=</span>  <span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>s<span class="token punctuation">:</span>q<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span> <span class="token comment">//此时q就是s的别名 为123</span>
  <span class="token punctuation">}</span>
  <span class="token constant">A</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token number">9</span>、获取当前元素的节点
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">input</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token operator">=</span>input<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" aria-hidden="true" class="header-anchor">#</a> 生命周期</h2> <div class="language-js extra-class"><pre class="language-js"><code>开始阶段
  componentWillMount 组件将要渲染
  componentDidMount  组件渲染完成
  render             开始渲染
      只要调用setState  无论数据是否变化 都会调用render方法
变化
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span>nextState<span class="token punctuation">)</span>
    <span class="token comment">//优化在这里做,返回ture 执行render() false不执行 </span>

  componentDidUpdate  组件更新完成
  componentWillUpdate 组件将要更新

  componentWillReceiveProps <span class="token function">组件接受到了新的属性</span>  <span class="token punctuation">(</span>第一次不触发<span class="token punctuation">)</span>
  componentWillUnmount  组件将要销毁 

  setState 在生命周期 开始阶段 和 将要接收新的属性调用 其他调用会无限循环

新的              
  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span>prevState<span class="token punctuation">)</span> <span class="token function">组件将要更新</span><span class="token punctuation">(</span>把以前的替换了<span class="token punctuation">)</span>
  <span class="token comment">//获取更新前的快照,必须有一个返回值(更新之前的属性,状态)会在componentDidUpdate第三个参数获取到</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span> <span class="token function">接受新的属性</span> <span class="token punctuation">(</span>把以前的替换了<span class="token punctuation">)</span>
  <span class="token comment">//第一次会触发,返回的是一个新的状态,没有显示调用setstate  返回的值直接盖上去</span>
  <span class="token comment">//生命周期都是同步,获取数据 放在组件更新完成、将要更新发送都可以  反正是要渲染2次的     </span>
</code></pre></div><h2 id="proptypes验证"><a href="#proptypes验证" aria-hidden="true" class="header-anchor">#</a> PropTypes验证</h2> <ul><li>import PropTypes from 'prop-types'</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//部分</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Types</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> a <span class="token operator">=</span> <span class="token string">'aaaaaaaaas'</span>
    
    <span class="token comment">// 名字是死的  给类增加静态属性 //es7 才有的</span>
    <span class="token comment">// defaultProps 和 父组件传递进来的 一样 都是this.props下的</span>
    <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'1231'</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//校验属性  只要是 this.props.下能获取到 都可以校验 (上面的name  也是)</span>
    <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      age<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
      name<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
      sex<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span><span class="token function">oneOf</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      fan<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span><span class="token function">shape</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          a<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
          b<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">//数组</span>
      arr<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span><span class="token function">arrayOf</span><span class="token punctuation">(</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">//自定义校验</span>
      <span class="token function">number2</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>propName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">//第一个是所有的this.props , propName指的就是number2</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>props<span class="token punctuation">[</span>propName<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'收益太低'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// console.log('123',this.props)</span>
        <span class="token comment">// console.log('123',Types.a)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
              types
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="setstate-异步渲染问题"><a href="#setstate-异步渲染问题" aria-hidden="true" class="header-anchor">#</a> setState 异步渲染问题</h2> <ul><li>setState用法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  setState用法
    第一个参数是赋值 第二个参数是回调
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    一般加异步是为了一个个执行 但都是后面覆盖前面
    用这个回调 也可以一个个执行 <span class="token punctuation">,</span> 但这个是嵌套
      也可以<span class="token punctuation">,</span>prevState是上次的结果
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span>prevState<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span>prevState<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token function-variable function">add1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 只会渲染一次</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">add2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 加异步  就会渲染多次</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>setState原</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 默认是批量更新的   setstate 异步更新原理</span>
  <span class="token keyword">let</span> isBatchingUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">let</span> <span class="token function-variable function">transcation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    component<span class="token punctuation">.</span>state <span class="token operator">=</span> component<span class="token punctuation">.</span>pendingState
    component<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isBatchingUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">My</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//自己的状态</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pendingState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>state<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>isBatchingUpdate<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">//批量更新 这里直走一次  也就是后面覆盖前面</span>
          <span class="token comment">// console.log('批量更新',obj)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>pendingState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>pendingState<span class="token punctuation">,</span><span class="token operator">...</span>obj<span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
          <span class="token comment">//异步更新 这里走完 一次 在</span>
          <span class="token comment">// console.log('异步更新',obj)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>pendingState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>this<span class="token punctuation">.</span>pendingState<span class="token punctuation">,</span><span class="token operator">...</span>obj<span class="token punctuation">}</span>
          <span class="token comment">// 每次都会回调自己</span>
          <span class="token function">transcation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// frist 如果是异步先走 transcation  那么isBatchingUpdate为false setState就会走else里面</span>
    <span class="token comment">//       如果是同步 就是直接调用 setState 走if(ture)</span>

      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token function">transcation</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// console.log(this.state.number)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

  <span class="token keyword">let</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">My</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  my<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="路由"><a href="#路由" aria-hidden="true" class="header-anchor">#</a> 路由</h2> <ul><li>分hash #和 history h5api (刷新的时候页面不存在,一定会出现404的问题)</li> <li>npm install react-router-dom</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">import</span> <span class="token punctuation">{</span>HashRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span>Route<span class="token punctuation">,</span>Switch<span class="token punctuation">,</span>Redirect<span class="token punctuation">,</span>Link<span class="token punctuation">,</span>NavLink<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
  基本用法
    Router 可以切换 hash 和	history  要包裹在最外面
    Route  用来声明路由的
      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/'</span>  exact<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>  
					exact<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> 是完全匹配 若是下面有二级路由不能加 
					通过Route组件渲染出来的页面 有三个属性 history<span class="token punctuation">,</span>lication<span class="token punctuation">,</span>match 

    Redirect 重定向  当没有匹配到路由时候的跳转
      <span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">'/'</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    
    Switch 匹配到一个后就不会在匹配了
      <span class="token operator">&lt;</span>Switch<span class="token operator">&gt;</span>
        里面包裹 Route组件 和 Redirect组件
      <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">&gt;</span>
      
    Link <span class="token function">标签用来跳转的</span> <span class="token punctuation">(</span>一般对Link和NavLink第二次包装的时候 
      可以在他们前面都Route 标签 可以获取history<span class="token punctuation">,</span>lication<span class="token punctuation">,</span>match属性<span class="token punctuation">)</span>
    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">'/'</span><span class="token operator">&gt;</span>首页<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>

    NavLink 跟Link一样的
			只是当路由是当他被激活的时候  会加一个<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">'active'</span>
        注意 to<span class="token operator">=</span><span class="token string">'/'</span> 要加一个  exact<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span>   不然点击别的时候 他也会加
          二级路由 不能写 exact
                
        path 和 to <span class="token operator">=</span><span class="token string">&quot;/&quot;</span> 最前面一定要加<span class="token operator">/</span>
                 
			<span class="token constant">JS</span>跳转路由	
			 	<span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/user/list'</span><span class="token punctuation">)</span>
    
  路由传值
    <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">'/user/:id'</span>  exact<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>  
		<span class="token operator">&lt;</span>link to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'/user/'</span><span class="token operator">+</span>id<span class="token punctuation">}</span><span class="token operator">&gt;</span>跳转<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>

  路由的高阶组件
    将Route 用组件包装做判断而已
      <span class="token number">1</span>、Route 默认情况下 直接 compoment<span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">B</span><span class="token punctuation">}</span> 之间渲染<span class="token constant">B</span>组件   
      <span class="token number">2</span>、包装 <span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token constant">A</span>组件返回一个包装后的Route 组件<span class="token punctuation">,</span> 可以在里面做拦截等逻辑
  
</code></pre></div><h2 id="render-component-children区别"><a href="#render-component-children区别" aria-hidden="true" class="header-anchor">#</a> render component children区别</h2> <ul><li>render和children 都是返回函数 component给一个组件</li> <li>children 不管路径没有没匹配到 都会渲染 如果是当前路径 则props.match 为ture
<ul><li>一般对NavLink做 二次处理 如果跳转的是当前 可以把active放到上级</li></ul></li> <li>render 就是返回函数
<ul><li>一般对Route 进行二次处理 如果登陆就正常返回 否则 拦截等操作</li></ul></li></ul> <h2 id="react-redux用法"><a href="#react-redux用法" aria-hidden="true" class="header-anchor">#</a> react-redux用法</h2> <ul><li>创建一个store</li> <li>actions 存放动作 =&gt; 导出的是一个对象 对象里面有操作的方法 方法返回对象  获得的对象传入reducers的第二个参数</li> <li>reducers 存放管理员 =&gt; 就是一个函数接受(state,aciton) 返回一个对象 修改store的数据</li> <li>index.js 导出store  将reducers传入redux里面的createStore中</li> <li>types.js 存放操作类型 操作的类型 避免写错 所以集中存放
<ul><li>redux 在创建的store的时候 将reducer(管理员放进去) 默认是执行一次dispatch state会接受默认值</li> <li>在组件内是通过调用store.dispatch 修改state里面的东西 store.getState获取state里面的值</li></ul></li></ul> <h2 id="couter-todolist-例子"><a href="#couter-todolist-例子" aria-hidden="true" class="header-anchor">#</a> couter&amp;&amp;todoList 例子</h2> <ul><li>目录</li> <li>src
<ul><li>components
<ul><li>counter.js</li> <li>List.js</li></ul></li> <li>store
<ul><li>actions
<ul><li>counter.js</li> <li>list.js</li></ul></li> <li>reducers
<ul><li>counter.js</li> <li>list.js</li> <li>index.js</li></ul></li> <li>index.js</li> <li>types.js</li></ul></li> <li>index.js</li> <li>saga.js</li></ul></li> <li>components/counter.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'../store/actions/counter'</span>
<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>计数<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>asyncAdd<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token keyword">async</span> 添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>sagaAdd<span class="token punctuation">}</span><span class="token operator">&gt;</span>saga 添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>del<span class="token punctuation">}</span><span class="token operator">&gt;</span>减少<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>asyncDel<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token keyword">async</span> 减少<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span>  <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    count <span class="token punctuation">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>count
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">//store.dispatch</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncAdd</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sagaAdd</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// saga 异步</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">sagaAdd</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">del</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">asyncDel</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// thunk 异步</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span>
</code></pre></div><ul><li>components/List.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> actions <span class="token keyword">from</span> <span class="token string">'../store/actions/list'</span>
<span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>ToDo List<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>count<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span>
              <span class="token punctuation">{</span>item<span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>add<span class="token punctuation">}</span><span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span>  <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">//store.getState()</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    count <span class="token punctuation">:</span> state<span class="token punctuation">.</span>list<span class="token punctuation">.</span>data
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">//store.dispatch</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span><span class="token function">tolist</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span>mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>List<span class="token punctuation">)</span>
</code></pre></div><ul><li>store/actions/counter.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'../types'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span>n<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">sagaAdd</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">SAGA_ADD</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span>n<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">del</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span>n<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>store/actions/counter.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'../types'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">tolist</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">TOLIST</span><span class="token punctuation">,</span>data<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>store/reducers/counter.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Tpyes <span class="token keyword">from</span> <span class="token string">'../types'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">counter</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>actions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进来了'</span><span class="token punctuation">,</span>actions<span class="token punctuation">)</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> Tpyes<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span>state<span class="token punctuation">.</span>count<span class="token operator">+</span>actions<span class="token punctuation">.</span>count<span class="token punctuation">}</span>
      <span class="token keyword">case</span> Tpyes<span class="token punctuation">.</span><span class="token constant">DECREMENT</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span>state<span class="token punctuation">.</span>count<span class="token operator">-</span>actions<span class="token punctuation">.</span>count<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><ul><li>store/reducers/list.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'../types'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">list</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>actions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>actions<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> Types<span class="token punctuation">.</span><span class="token constant">TOLIST</span><span class="token punctuation">:</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>data<span class="token punctuation">,</span>actions<span class="token punctuation">.</span>data<span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><ul><li>store/reducers/index.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>combineReducers<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> counter  <span class="token keyword">from</span> <span class="token string">'./counter'</span>
<span class="token keyword">import</span> list  <span class="token keyword">from</span> <span class="token string">'./list'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token punctuation">,</span>
  list
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>store/index.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createSagaMiddleware  <span class="token keyword">from</span> <span class="token string">'redux-saga'</span>
<span class="token keyword">import</span> rootSaga <span class="token keyword">from</span> <span class="token string">'../saga'</span>
<span class="token keyword">let</span> sageMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// sageMiddleware 是用来拦截对saga中间件请求的</span>
<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sageMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sageMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre></div><ul><li>store/types.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INCREMENT</span> <span class="token operator">=</span> <span class="token string">'INCREMENT'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">TOLIST</span> <span class="token operator">=</span> <span class="token string">'TOLIST'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">DECREMENT</span> <span class="token operator">=</span> <span class="token string">'DECREMENT'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">SAGA_ADD</span> <span class="token operator">=</span> <span class="token string">'SAGA_ADD'</span>
</code></pre></div><ul><li>index.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./components/Counter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">'./components/List'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>List <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>saga.js (待完善)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>takeEvery<span class="token punctuation">,</span>put<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'./store/types'</span>

<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span>ms<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 这是saga的唯一入口</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//拦截或者监听SAGA_ADD动作,然后执行对应的workerSaga</span>
  <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>Types<span class="token punctuation">.</span><span class="token constant">SAGA_ADD</span><span class="token punctuation">,</span>minus<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//当yield一个promise的时候,程序不会立刻执行 等待时间 在执行</span>
  <span class="token keyword">yield</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//产出了一个promise</span>
  <span class="token comment">//put相当于dispatch(action)</span>
  <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="redux核心"><a href="#redux核心" aria-hidden="true" class="header-anchor">#</a> redux核心</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">CreateStore</span><span class="token punctuation">(</span><span class="token parameter">reducer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> state<span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">getters</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">;</span>
  <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>action<span class="token punctuation">)</span>
    listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=&gt;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'@INIT'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token function-variable function">subscribe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      listeners <span class="token operator">=</span> listeners<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">l</span><span class="token operator">=&gt;</span>l<span class="token operator">!=</span>fn<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    getters<span class="token punctuation">,</span>
    dispatch<span class="token punctuation">,</span>
    subscribe
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> CreateStore <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="redux-saga-原理"><a href="#redux-saga-原理" aria-hidden="true" class="header-anchor">#</a> redux-saga 原理</h2> <ul><li>用法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// store/index</span>
  <span class="token keyword">import</span> createSagaMiddleware  <span class="token keyword">from</span> <span class="token string">'redux-saga'</span>
  <span class="token keyword">import</span> rootSaga <span class="token keyword">from</span> <span class="token string">'../saga'</span>
  <span class="token keyword">let</span> sageMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//sageMiddleware放到中间件里面</span>
  <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sageMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//运行</span>
  sageMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span>

  <span class="token comment">// src/saga</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>takeEvery<span class="token punctuation">,</span>put<span class="token punctuation">,</span>take<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./redux-saga/effect'</span>
  <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'./store/types'</span>
  
  <span class="token comment">// rootSage 是核心的 导出函数</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`第</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">次`</span></span><span class="token punctuation">)</span>
      <span class="token comment">// take监听一次 会触发 subscribe  </span>
      <span class="token comment">// 默认rootSage会执行一次  也就是take会被</span>
      <span class="token comment">// take 里面的type 要和 按键触发的 type 一样 才能触发 put</span>
      <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>Types<span class="token punctuation">.</span><span class="token constant">SAGA_ADD</span><span class="token punctuation">)</span>
      <span class="token comment">// put 当点击的时候 才触发他</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'结束了。。。'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 或者</span>
  <span class="token comment">// 定时器</span>
  <span class="token comment">// const delay = ms =&gt;new Promise((res,rej)=&gt;{</span>
  <span class="token comment">//   setTimeout(res,ms)</span>
  <span class="token comment">// })</span>
  <span class="token comment">// export default function * rootSaga(){</span>
  <span class="token comment">//   //拦截或者监听SAGA_ADD动作,然后执行对应的workerSaga</span>
  <span class="token comment">//   yield takeEvery(Types.SAGA_ADD,minus);</span>
  <span class="token comment">// }</span>

  <span class="token comment">// export function * minus() {</span>
  <span class="token comment">//   //当yield一个promise的时候,程序不会立刻执行 等待时间 在执行</span>
  <span class="token comment">//   yield delay(1000);//产出了一个promise</span>
  <span class="token comment">//   //put相当于dispatch(action)</span>
  <span class="token comment">//   yield put({type:Types.INCREMENT,count:1})</span>
  <span class="token comment">// }</span>

  再派发的时候 只需要添加 type 对应的类型  每次触发 redux<span class="token operator">-</span>saga就会拦截处理
   <span class="token function">take</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>里面是拦截的类型
   <span class="token function">put</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span> 里面真正dispatch的内容
</code></pre></div><ul><li>saga原理
<ul><li>主要依靠co库 和 发布订阅模式</li> <li>rootSage放到run(rootSage)执行了</li> <li>createChannel 函数就是一个发布订阅</li> <li>take就是订阅 将每次接受的类型存储 =&gt; 触发 subscribe</li> <li>takeEvery将得到的生成器 通过fork传递进去 在开器子进程 run(生成器) 最后子进程去publish</li> <li>channel.publish(action) 就是拦截中间件的  检查传递进来的type和take里面的type是否一致
<ul><li>若相同 执行listener(action) 也就是take传递的第二个参数  就是回调next() =&gt; put</li></ul></li></ul></li> <li>redux-saga/index</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token comment">//发布订阅</span>
  <span class="token keyword">function</span> <span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span>listener</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'actionType'</span><span class="token punctuation">,</span>actionType<span class="token punctuation">)</span>
      events<span class="token punctuation">[</span>actionType<span class="token punctuation">]</span> <span class="token operator">=</span> listener
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">let</span> listener <span class="token operator">=</span> events<span class="token punctuation">[</span>action<span class="token punctuation">.</span>type<span class="token punctuation">]</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'actionType'</span><span class="token punctuation">,</span>action<span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 默认只执行一次 所以要删除</span>
        <span class="token keyword">delete</span> events<span class="token punctuation">[</span>action<span class="token punctuation">]</span>
        <span class="token comment">//  listener(action) 就是执行中间件的next(action)</span>
        <span class="token function">listener</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>subscribe<span class="token punctuation">,</span>publish<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> channel <span class="token operator">=</span> <span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token parameter">done<span class="token punctuation">,</span>total</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">==</span> total<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">sagaMiddleware</span><span class="token punctuation">(</span><span class="token parameter">stroe</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">generator<span class="token punctuation">,</span>finish</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行生成器,得到迭代器</span>
      <span class="token keyword">let</span> it <span class="token operator">=</span>  <span class="token keyword">typeof</span> generator <span class="token operator">==</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>generator<span class="token punctuation">;</span>

      <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// value:effect =&gt; 将value改名为effect</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>value<span class="token punctuation">:</span>effect<span class="token punctuation">,</span>done<span class="token punctuation">}</span> <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'默认执行一次,也就是执行take 发布一下而'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> effect<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token function">run</span><span class="token punctuation">(</span>effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>then<span class="token punctuation">)</span><span class="token punctuation">{</span>
            effect<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">switch</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">'take'</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>订阅某个动作类型
                    channel<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>actionType<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'put'</span><span class="token punctuation">:</span>
                    stroe<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>action<span class="token punctuation">)</span>
                    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'fork'</span><span class="token punctuation">:</span>
                    <span class="token comment">// 接受到的是一个生成器 需要传给run处理</span>
                    <span class="token function">run</span><span class="token punctuation">(</span>effect<span class="token punctuation">.</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'call'</span><span class="token punctuation">:</span>
                    effect<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>effect<span class="token punctuation">.</span>args<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">'all'</span><span class="token punctuation">:</span>
                    <span class="token keyword">let</span> final <span class="token operator">=</span> <span class="token function">times</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span>effect<span class="token punctuation">.</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">)</span> 
                    effect<span class="token punctuation">.</span>fns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=&gt;</span><span class="token function">run</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span>final<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//全部完成后</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'完成'</span><span class="token punctuation">)</span>
          finish <span class="token operator">&amp;&amp;</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    sagaMiddleware<span class="token punctuation">.</span>run <span class="token operator">=</span> run<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// store.dispatch 就等于执行最里面的函数</span>
        channel<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token comment">//派发action</span>
        <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sagaMiddleware
<span class="token punctuation">}</span>
</code></pre></div><ul><li>redux-saga/effect.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span>  <span class="token function">take</span><span class="token punctuation">(</span><span class="token parameter">actionType</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span><span class="token string">'take'</span><span class="token punctuation">,</span>
      actionType
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span>  <span class="token function">put</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span><span class="token string">'put'</span><span class="token punctuation">,</span>
      action
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token string">'fork'</span><span class="token punctuation">,</span>
    task
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 1、不能阻塞当前的generator函数
 *  开启一个新的线程 就相当于单独重新run
 * fork   
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span><span class="token parameter">actionType<span class="token punctuation">,</span>task</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">take</span><span class="token punctuation">(</span>actionType<span class="token punctuation">)</span>
      <span class="token keyword">yield</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token string">'call'</span><span class="token punctuation">,</span>
    fn<span class="token punctuation">,</span>
    args
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">fns</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token string">'all'</span><span class="token punctuation">,</span>
    fns
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>src/saga</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>takeEvery<span class="token punctuation">,</span>put<span class="token punctuation">,</span>take<span class="token punctuation">,</span>call<span class="token punctuation">,</span>all <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./redux-saga/effects'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Types <span class="token keyword">from</span> <span class="token string">'./store/types'</span>

<span class="token comment">/**
 * take 会阻塞  take 和 put 不能传递一样的类型 会无线循环
 */</span>
<span class="token comment">// export default function * rootSaga(){</span>
<span class="token comment">//   for(var i=0;i&lt;3;i++){</span>
<span class="token comment">//     console.log(`第${i}次`)</span>
<span class="token comment">//     // take监听一次 会触发 subscribe  </span>
<span class="token comment">//     // 默认rootSaga会执行一次  也就是take会被</span>
<span class="token comment">//     // take 里面的type 要和 按键触发的 type 一样 才能触发 put</span>
<span class="token comment">//     yield take(Types.SAGA_ADD)</span>
<span class="token comment">//     // put 当点击的时候 才触发他</span>
<span class="token comment">//     yield add()</span>
<span class="token comment">//   }</span>
<span class="token comment">//   console.log('结束了。。。')</span>
<span class="token comment">// }</span>

<span class="token comment">/**
 * takeEvery 不会阻塞 &amp;&amp; call
 * takeEvery 第三个参数 会传递给 第二个参数(生成器)
 * 第二个参数 生成器最后一个参数 默认接收到的是action
 */</span>
<span class="token comment">// const delay = ms =&gt;new Promise((res,rej)=&gt;{</span>
<span class="token comment">//   // setTimeout(res,ms)</span>
<span class="token comment">//   setTimeout(()=&gt;{</span>
<span class="token comment">//       res('--',new Date())</span>
<span class="token comment">//   },ms)</span>
  
<span class="token comment">// })</span>
<span class="token comment">// // 这是saga的唯一入口</span>
<span class="token comment">// export default function * rootSaga(){</span>
<span class="token comment">//   //拦截或者监听SAGA_ADD动作,然后执行对应的workerSaga</span>
<span class="token comment">//   yield takeEvery(Types.SAGA_ADD,add);</span>
<span class="token comment">// }</span>

<span class="token comment">// export function * add(action) {</span>
<span class="token comment">//   //当takeEvery 没有传值的时候 默认就是action 若传递值 最后一个 也是acrion</span>

<span class="token comment">//   //当yield一个promise的时候,程序不会立刻执行 等待时间 在执行</span>
<span class="token comment">//   // let rs =yield delay(1000);//产出了一个promise</span>
<span class="token comment">//   // console.log('rs',rs)</span>
<span class="token comment">//   // 一般异步用 call</span>
<span class="token comment">//   let date = yield call(delay,1000)</span>
<span class="token comment">//   //put相当于dispatch(action)</span>
<span class="token comment">//   yield put({type:Types.INCREMENT,count:1})</span>
<span class="token comment">// }</span>

<span class="token comment">/**
 * all
 */</span>

 <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'加1.。'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">loggerWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>Types<span class="token punctuation">.</span><span class="token constant">SAGA_ADD</span><span class="token punctuation">,</span>logger<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>Types<span class="token punctuation">.</span><span class="token constant">INCREMENT</span><span class="token punctuation">,</span>count<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">addWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">yield</span> <span class="token function">takeEvery</span><span class="token punctuation">(</span>Types<span class="token punctuation">.</span><span class="token constant">SAGA_ADD</span><span class="token punctuation">,</span>add<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// all 全部的意思 promise.all</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//拦截或者监听SAGA_ADD动作,然后执行对应的workerSaga</span>
  <span class="token keyword">yield</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">loggerWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">addWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'the end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="dva用法"><a href="#dva用法" aria-hidden="true" class="header-anchor">#</a> dva用法</h2> <ul><li>流程图</li> <li>脚手架
<ul><li>npm install dva-cli@next -g(1+ 的版本采用的umi)</li> <li>dva new xx</li> <li>cd xx</li> <li>cnpm i styled-components -S</li> <li>npm start
<img src="/img/dva.png"></li></ul></li> <li>基本使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> dva<span class="token punctuation">,</span><span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'dva'</span>

<span class="token comment">// dva 其实就是一个函数</span>
<span class="token keyword">const</span> <span class="token operator">=</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>ms<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span>res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> rs
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//里面的是 子状态</span>
  namespace<span class="token punctuation">:</span><span class="token string">'count'</span><span class="token punctuation">,</span>
  state<span class="token punctuation">:</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">//相当于action type 参数是老状态 返回值是新状态</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 数据持久化</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>number<span class="token punctuation">:</span>state<span class="token punctuation">.</span>number <span class="token operator">+</span> payload<span class="token punctuation">}</span>
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> data
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token punctuation">{</span>number<span class="token punctuation">:</span>state<span class="token punctuation">.</span>number <span class="token operator">-</span> payload<span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  effects<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">//effect 里面放的是generator</span>
    <span class="token comment">// 第一个参数里action动作对象 effects副作用 reudx-saga/effects</span>
    <span class="token operator">*</span><span class="token function">addAmount</span><span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span><span class="token punctuation">{</span>put<span class="token punctuation">,</span>call<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// yield call(delay,1000);</span>
      <span class="token keyword">let</span> rs <span class="token operator">=</span>  <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">get</span><span class="token punctuation">,</span><span class="token string">'http://localhost:3001/amount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'add'</span><span class="token punctuation">,</span>payload<span class="token punctuation">:</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 订阅</span>
  subscriptions<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>history<span class="token punctuation">,</span>dispatch<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> todosStr <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> data <span class="token operator">=</span> todosStr<span class="token operator">?</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>todosStr<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token comment">// Warning: dispatch: todos/load should not be prefixed with namespace todos</span>
      <span class="token comment">// 在model时派发action,不需要加命名空间的前缀 默认就是, 可以省略</span>
      <span class="token comment">// dispatch({type:'todos/load',payload:list})</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'add'</span><span class="token punctuation">,</span>payload<span class="token punctuation">:</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  <span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>count
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'count/addAmount'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'count/minusAmount'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token operator">&lt;</span>App<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>dva 原理
<ul><li>dome 和原理 配合看</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> dva<span class="token punctuation">,</span><span class="token punctuation">{</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Router<span class="token punctuation">,</span>Route<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dva/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Link<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">delay</span> <span class="token operator">=</span> <span class="token parameter">ms</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>ms<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  namespace<span class="token punctuation">:</span><span class="token string">'count'</span><span class="token punctuation">,</span>
  state<span class="token punctuation">:</span><span class="token punctuation">{</span>number<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>number<span class="token punctuation">:</span>state<span class="token punctuation">.</span>number<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  effects<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token function">asyncAdd</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>call<span class="token punctuation">,</span>put<span class="token punctuation">}</span><span class="token punctuation">,</span>actions</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token function">call</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'jinali l '</span><span class="token punctuation">,</span>actions<span class="token punctuation">)</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'count/add'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Count <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>返回<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>number<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'count/add'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>props<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span><span class="token string">'count/asyncAdd'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>asyncAdd<span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Link to<span class="token operator">=</span><span class="token string">'/count'</span><span class="token operator">&gt;</span>count<span class="token operator">&lt;</span><span class="token operator">/</span>Link<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> 

app<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>history<span class="token punctuation">,</span> app<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Router history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">'/'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>Route  path<span class="token operator">=</span><span class="token string">'/count'</span> component<span class="token operator">=</span><span class="token punctuation">{</span>Count<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>dva/router.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Router<span class="token punctuation">,</span>Route<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
  Router<span class="token punctuation">,</span>Route
<span class="token punctuation">}</span>
</code></pre></div><ul><li>dva/index.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span>combineReducers<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Provider<span class="token punctuation">,</span>connect<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token comment">// import {takeEvery} from 'redux-saga/effects'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> effects <span class="token keyword">from</span> <span class="token string">'redux-saga/effects'</span>
<span class="token keyword">import</span> createSagaMiddleware <span class="token keyword">from</span> <span class="token string">'redux-saga'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createHashHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'history'</span>
<span class="token comment">// 普通导出 引入的时候需要结构</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>connect<span class="token punctuation">}</span>
<span class="token comment">// 默认导出 引入直接用</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> _app<span class="token operator">=</span><span class="token punctuation">{</span>
    _store<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//放所有的仓库</span>
    _models<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//这里面放着所有的模型</span>
    model<span class="token punctuation">,</span><span class="token comment">//方法</span>
    _route<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token comment">//所有的路由配置</span>
    router<span class="token punctuation">,</span><span class="token comment">//方法</span>
    start<span class="token punctuation">,</span><span class="token comment">//方法</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">model</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//每次调用model 就将他存放到总的模型库里面</span>
    _app<span class="token punctuation">.</span>_models<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">router</span><span class="token punctuation">(</span><span class="token parameter">routerConfig</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    _app<span class="token punctuation">.</span>_router <span class="token operator">=</span> routerConfig
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> App <span class="token operator">=</span> _app<span class="token punctuation">.</span><span class="token function">_router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>history<span class="token punctuation">,</span>app<span class="token punctuation">:</span>_app<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 每一个模型 都有namespace 都是状态树中的子属性, 都有一个子的reducer</span>
    <span class="token comment">// combineReducers 合并的时候传入一个对象 key是属性名 值是处理函数</span>

    <span class="token keyword">let</span> reducers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> m <span class="token keyword">of</span> _app<span class="token punctuation">.</span>_models<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// key 是namespace的值 value是一个reducer函数</span>
      reducers<span class="token punctuation">[</span>m<span class="token punctuation">.</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>m<span class="token punctuation">.</span>state<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// action =&gt; 一般都是 'count/add'等等</span>
        <span class="token comment">// 截取action / 后面名字  查看m.namespace 当前的reducers下是否有该名字(方法)</span>
        <span class="token keyword">let</span> actionType <span class="token operator">=</span> action<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token punctuation">[</span>namespace<span class="token punctuation">,</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> actionType<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 当action里命名空间  和 当前方法命名空间 相同 才需要处理</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>namespace <span class="token operator">==</span> m<span class="token punctuation">.</span>namespace<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">let</span> reducer <span class="token operator">=</span> m<span class="token punctuation">.</span>reducers<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token comment">// 此时说明有该方法 就执行</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>action<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
          <span class="token keyword">return</span> state<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span>reducers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sagaMiddleware <span class="token operator">=</span> <span class="token function">createSagaMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">rootSaga</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> m <span class="token keyword">of</span> _app<span class="token punctuation">.</span>_models<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>effects<span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">//监听每个动作发生,当动作发生的时候 执行对应的generator 任务</span>
          <span class="token comment">// takeEvery(action,fn)</span>
          <span class="token comment">// 第三个参数 effects 传递给 *asyncAdd()的第二个参数</span>
          <span class="token keyword">yield</span> effects<span class="token punctuation">.</span><span class="token function">takeEvery</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>namespace<span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span>key<span class="token punctuation">,</span>m<span class="token punctuation">.</span>effects<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>effects<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>sagaMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sagaMiddleware<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>rootSaga<span class="token punctuation">)</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>App<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span>
      <span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> _app
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/qianduan/js.html" class="prev">
          js
        </a></span> <span class="next"><a href="/qianduan/vue.html">
          vue 汇总
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c4cf2eda.js" defer></script><script src="/assets/js/24.f22c2e26.js" defer></script>
  </body>
</html>
